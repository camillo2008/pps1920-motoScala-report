<!DOCTYPE html>
<html  dir="ltr">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title> MOTOSCALA </title>
        <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon-precomposed" href="images/apple-touch-icon.png">

<link rel="stylesheet" href="./pandoc-uikit/uikit.css">

        <link rel="stylesheet" href="style.css">
        <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
        <script src="uikit.js"></script>
        <script src="scripts.js"></script>
        <script src="jquery.sticky-kit.js"></script>

        <meta name="generator" content="pandoc-uikit" />
                <meta name="author" content="Kiade Sara sara.kiade@studio.unibo.it" />
                <meta name="author" content="Caminati Gyordan gyordan.caminati@studio.unibo.it" />
                <meta name="author" content="Giulianini Luca luca.giulianini2@studio.unibo.it" />
                <meta name="author" content="Ceroni Ruben ruben.ceroni@studio.unibo.it" />
                        <title> MOTOSCALA </title>
        <style type="text/css">code{white-space: pre;}</style>
                        <style type="text/css">
            pre > code.sourceCode { white-space: pre; position: relative; }
            pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
            pre > code.sourceCode > span:empty { height: 1.2em; }
            code.sourceCode > span { color: inherit; text-decoration: inherit; }
            div.sourceCode { margin: 1em 0; }
            pre.sourceCode { margin: 0; }
            @media screen {
            div.sourceCode { overflow: auto; }
            }
            @media print {
            pre > code.sourceCode { white-space: pre-wrap; }
            pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
            }
            pre.numberSource code
              { counter-reset: source-line 0; }
            pre.numberSource code > span
              { position: relative; left: -4em; counter-increment: source-line; }
            pre.numberSource code > span > a:first-child::before
              { content: counter(source-line);
                position: relative; left: -1em; text-align: right; vertical-align: baseline;
                border: none; display: inline-block;
                -webkit-touch-callout: none; -webkit-user-select: none;
                -khtml-user-select: none; -moz-user-select: none;
                -ms-user-select: none; user-select: none;
                padding: 0 4px; width: 4em;
                color: #aaaaaa;
              }
            pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
            div.sourceCode
              {   }
            @media screen {
            pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
            }
            code span.al { color: #ff0000; font-weight: bold; } /* Alert */
            code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
            code span.at { color: #7d9029; } /* Attribute */
            code span.bn { color: #40a070; } /* BaseN */
            code span.bu { } /* BuiltIn */
            code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
            code span.ch { color: #4070a0; } /* Char */
            code span.cn { color: #880000; } /* Constant */
            code span.co { color: #60a0b0; font-style: italic; } /* Comment */
            code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
            code span.do { color: #ba2121; font-style: italic; } /* Documentation */
            code span.dt { color: #902000; } /* DataType */
            code span.dv { color: #40a070; } /* DecVal */
            code span.er { color: #ff0000; font-weight: bold; } /* Error */
            code span.ex { } /* Extension */
            code span.fl { color: #40a070; } /* Float */
            code span.fu { color: #06287e; } /* Function */
            code span.im { } /* Import */
            code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
            code span.kw { color: #007020; font-weight: bold; } /* Keyword */
            code span.op { color: #666666; } /* Operator */
            code span.ot { color: #007020; } /* Other */
            code span.pp { color: #bc7a00; } /* Preprocessor */
            code span.sc { color: #4070a0; } /* SpecialChar */
            code span.ss { color: #bb6688; } /* SpecialString */
            code span.st { color: #4070a0; } /* String */
            code span.va { color: #19177c; } /* Variable */
            code span.vs { color: #4070a0; } /* VerbatimString */
            code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
        </style>
                                               
    </head>

    <body>


        <div class="uk-container uk-container-center uk-margin-top uk-margin-large-bottom">

                        <div class="uk-grid" data-uk-grid-margin>
                <div class="uk-width-1-1">
                    <h1 class="uk-heading-large"> MOTOSCALA </h1>
                                        <h3 class="uk-heading-large">October 2020</p></h3>
                                                            <p class="uk-text-large">Kiade Sara<br />
<a href="mailto:sara.kiade@studio.unibo.it"><code>sara.kiade@studio.unibo.it</code></a></p>
                                        <p class="uk-text-large">Caminati Gyordan<br />
<a href="mailto:gyordan.caminati@studio.unibo.it"><code>gyordan.caminati@studio.unibo.it</code></a></p>
                                        <p class="uk-text-large">Giulianini Luca<br />
<a href="mailto:luca.giulianini2@studio.unibo.it"><code>luca.giulianini2@studio.unibo.it</code></a></p>
                                        <p class="uk-text-large">Ceroni Ruben<br />
<a href="mailto:ruben.ceroni@studio.unibo.it"><code>ruben.ceroni@studio.unibo.it</code></a></p>
                                    </div>
            </div>
            
            <div class="uk-grid" data-uk-grid-margin >          
                <div class="uk-width-medium-1-4">
                    <div class="uk-overflow-container" data-uk-sticky="{top:25,media: 768}">
                        <div class="uk-panel uk-panel-box menu-begin" >

                                                        <ul class="incremental">
                                                        <li><a href="#introduzione"><span class="toc-section-number">1</span> Introduzione</a>
                                                        <ul class="incremental">
                                                        <li><a href="#il-gioco"><span class="toc-section-number">1.1</span> Il gioco</a></li>
                                                        <li><a href="#gli-obiettivi"><span class="toc-section-number">1.2</span> Gli obiettivi</a></li>
                                                        </ul></li>
                                                        <li><a href="#processo-di-sviluppo"><span class="toc-section-number">2</span> Processo di Sviluppo</a>
                                                        <ul class="incremental">
                                                        <li><a href="#metodologia-di-sviluppo"><span class="toc-section-number">2.1</span> Metodologia di Sviluppo</a></li>
                                                        <li><a href="#gestione-di-progetto"><span class="toc-section-number">2.2</span> Gestione di Progetto</a></li>
                                                        <li><a href="#continuous-integration-e-automatizzazione"><span class="toc-section-number">2.3</span> Continuous Integration e Automatizzazione</a></li>
                                                        </ul></li>
                                                        <li><a href="#analisi-dei-requisiti"><span class="toc-section-number">3</span> Analisi dei Requisiti</a>
                                                        <ul class="incremental">
                                                        <li><a href="#requisiti-di-business"><span class="toc-section-number">3.1</span> Requisiti di Business</a></li>
                                                        <li><a href="#requisiti-utente"><span class="toc-section-number">3.2</span> Requisiti Utente</a></li>
                                                        <li><a href="#requisiti-funzionali"><span class="toc-section-number">3.3</span> Requisiti Funzionali</a></li>
                                                        <li><a href="#requisiti-non-funzionali"><span class="toc-section-number">3.4</span> Requisiti non Funzionali</a></li>
                                                        <li><a href="#requisiti-implementativi"><span class="toc-section-number">3.5</span> Requisiti Implementativi</a></li>
                                                        </ul></li>
                                                        <li><a href="#design-architetturale"><span class="toc-section-number">4</span> Design Architetturale</a>
                                                        <ul class="incremental">
                                                        <li><a href="#architettura-generale"><span class="toc-section-number">4.1</span> Architettura Generale</a></li>
                                                        <li><a href="#pattern-architetturali-utilizzati"><span class="toc-section-number">4.2</span> Pattern Architetturali Utilizzati</a></li>
                                                        <li><a href="#scelte-tecnologiche-cruciali"><span class="toc-section-number">4.3</span> Scelte Tecnologiche Cruciali</a></li>
                                                        </ul></li>
                                                        <li><a href="#design-di-dettaglio"><span class="toc-section-number">5</span> Design di Dettaglio</a>
                                                        <ul class="incremental">
                                                        <li><a href="#sec:ecs_design"><span class="toc-section-number">5.1</span> ECS</a></li>
                                                        <li><a href="#sec:mediator_design"><span class="toc-section-number">5.2</span> Mediator</a></li>
                                                        <li><a href="#sec:view_design"><span class="toc-section-number">5.3</span> View</a></li>
                                                        <li><a href="#sec:file_manager_design"><span class="toc-section-number">5.4</span> File Manager</a></li>
                                                        <li><a href="#sec:audio_manager_design"><span class="toc-section-number">5.5</span> Audio Manager</a></li>
                                                        <li><a href="#sec:client_server_design"><span class="toc-section-number">5.6</span> Client Server</a></li>
                                                        <li><a href="#sec:interactions_design"><span class="toc-section-number">5.7</span> Interazioni</a></li>
                                                        </ul></li>
                                                        <li><a href="#implementazione"><span class="toc-section-number">6</span> Implementazione</a>
                                                        <ul class="incremental">
                                                        <li><a href="#luca-giulianini"><span class="toc-section-number">6.1</span> Luca Giulianini</a></li>
                                                        <li><a href="#ruben-ceroni"><span class="toc-section-number">6.2</span> Ruben Ceroni</a></li>
                                                        <li><a href="#gyordan-caminati"><span class="toc-section-number">6.3</span> Gyordan Caminati</a></li>
                                                        </ul></li>
                                                        <li><a href="#retrospettiva"><span class="toc-section-number">7</span> Retrospettiva</a>
                                                        <ul class="incremental">
                                                        <li><a href="#processo-di-sviluppo-1"><span class="toc-section-number">7.1</span> Processo di Sviluppo</a></li>
                                                        <li><a href="#backlog"><span class="toc-section-number">7.2</span> Backlog</a></li>
                                                        <li><a href="#iterazioni"><span class="toc-section-number">7.3</span> Iterazioni</a></li>
                                                        </ul></li>
                                                        </ul>
                            
                        </div>
                    </div>
                </div>

                <div class="uk-width-medium-3-4">
<section id="introduzione" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduzione</h1>
<p>L’obiettivo del progetto è quello di <strong>sviluppare</strong> un gioco arcade ispirato a <strong>Motos</strong>, avendo cura di mantenere un alto grado di <strong>qualità</strong> non solo nel risultato dell’<strong>implementazione</strong> ma anche in tutto ciò che riguarda il <strong>processo di sviluppo</strong>. Per questo motivo tutti i <strong>passaggi</strong> che porteranno al risultato finale verranno <strong>analizzati</strong> con attenzione e <strong>documentati</strong> in maniera <strong>dettagliata</strong>.</p>
<section id="il-gioco" data-number="1.1">
<h2 data-number="1.1"><span class="header-section-number">1.1</span> Il gioco</h2>
<p>L’arcade <strong>originale</strong> consiste in un un <strong>campo</strong> bidimensionale sul quale il giocatore <strong>pilota</strong> una navicella e ha l’obiettivo di <strong>eliminare</strong> le entità nemiche spingendole <strong>fuori</strong> dal campo, <strong>senza</strong> essere eliminato a sua volta.</p>
<p><strong>MotoScala</strong> replicherà gli aspetti principali del gioco originale, arricchendoli con l’inserimento di nuove <strong>feature</strong>, come il concetto di <strong>durata vitale</strong> delle entità e il <strong>multiplayer</strong>.</p>
</section>
<section id="gli-obiettivi" data-number="1.2">
<h2 data-number="1.2"><span class="header-section-number">1.2</span> Gli obiettivi</h2>
<p>Durante lo svolgimento del progetto si punterà al raggiungimento di <strong>obiettivi</strong> riguardanti il <strong>processo di sviluppo</strong>:</p>
<ul class="incremental">
<li><p>Rispetto delle <strong>specifiche</strong> non opzionali ed eventualmente integrazione di quelle aggiuntive.</p></li>
<li><p>Utilizzo appropriato di tecniche <strong>avanzate</strong> di <strong>gestione</strong> del progetto.</p></li>
<li><p>Rispetto degli standard di <strong>qualità</strong> introdotti a lezione.</p></li>
</ul>
</section>
</section>
<section id="processo-di-sviluppo" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Processo di Sviluppo</h1>
<p>In questo capitolo verranno analizzati in dettaglio i processi relativi alle <strong>metodologie di sviluppo</strong> e <strong>gestione di progetto</strong> utilizzati. Per ogni processo inoltre, verrà fornita una breve descrizione di come esso sia stato <strong>implementato</strong> (tools, websites, ecc) e <strong>automatizzato</strong> (CI).</p>
<section id="metodologia-di-sviluppo" data-number="2.1">
<h2 data-number="2.1"><span class="header-section-number">2.1</span> Metodologia di Sviluppo</h2>
<p>Per quanto riguarda la metodologia di sviluppo scelta si è deciso di optare per un approccio moderno di tipo iterativo. Fra i tanti modelli presenti abbiamo scelto di mettere in pratica la metodologia <strong>Agile</strong> basata su <code>Scrum</code>. Data l’inesperienza nel campo del project management abbiamo deciso di non scegliere una figura di <strong>Scrum Master</strong> in modo da avere un maggiore equilibrio decisionale. È stato invece definito il ruolo di <strong>Product Owner</strong>, svolto da Luca Giulianini, al quale è stato affidate le mansioni di <strong>controllo qualità</strong> e <strong>validazione dei requisiti</strong>.</p>
<section id="subsec:scrum" data-number="2.1.1">
<h3 data-number="2.1.1"><span class="header-section-number">2.1.1</span> Scrum</h3>
<section id="par:sprint" data-number="2.1.1.0.1">
<h5 data-number="2.1.1.0.1"><span class="header-section-number">2.1.1.0.1</span> Sprint</h5>
<p>Gli <strong>Sprint</strong> hanno durata <strong>settimanale</strong> e, al termine di ognuno di essi, viene effettuata una <strong>runione</strong> generale di tutto il team al fine di <strong>valutare i risultati</strong> ottenuti. La riunione funge inoltre da <em>strumento di confronto e dialogo</em> per quanto riguarda eventuali problemi emersi durante lo stesso Sprint. Una volta conclusa la riunione viene lasciata la parola al <strong>Product Owner</strong> il quale riassume brevemente lo stato attuale dello Sprint fornendo una breve <strong>valutazione</strong> circa la <strong>qualità</strong> dei <strong>deliverables</strong> prodotti e la loro aderenza ai <strong>requisiti</strong> precedentemente analizzati. Nel caso in cui vengano rilevate problematiche a livello qualitativo o di tempistiche, il team procederà a una ridefinizione del <strong>piano di lavoro</strong> modificando opportunamente la <strong>schedula</strong> in modo da permettere un recupero graduale.</p>
</section>
<section id="par:backlog" data-number="2.1.1.0.2">
<h5 data-number="2.1.1.0.2"><span class="header-section-number">2.1.1.0.2</span> Backlog</h5>
<p>Lo <strong>Sprint Backlog</strong> viene stilato dal team di settimana in settimana e alla fine di ogni Sprint, durante la consueta riunione generale, vengono valutati gli eventuali problemi aggiornando opportunamente il <strong>Product Backlog</strong>. Nel caso in cui uno Sprint venga completato con successo, il team procederà a incontrarsi nuovamente al fine di definire la documentazione relativa alla <strong>nuova iterazione</strong> e quindi il nuovo Sprint Backlog. Gli <strong>items</strong> del Product Backlog da introdurre nello Sprint sono <strong>concordati</strong> dall’intero team di sviluppo. Ogni item per comodità viene scomposto nei suoi <strong>Sprint Tasks</strong> di base e per ognuno di essi viene attribuito un valore di <strong>effort</strong> concordato dal team. Infine l’<strong>assegnazione</strong> dei task ai vari componenti del gruppo viene effettuata seguendo principalmente l’affinità con le <strong>abilità</strong> dei singoli membri del team.</p>
</section>
</section>
</section>
<section id="gestione-di-progetto" data-number="2.2">
<h2 data-number="2.2"><span class="header-section-number">2.2</span> Gestione di Progetto</h2>
<p>Come abbiamo visto in <a href="#subsec:scrum" data-reference-type="ref" data-reference="subsec:scrum">2.1.1</a> la metodologia di sviluppo utilizzata è caratterizzata da una grande componente di <strong>interazione</strong> fra i membri del gruppo. Dato questo presupposto è fondamentale mettere in campo una serie di <strong>tecnologie</strong> e <strong>strumenti</strong> che permettano di semplificare questo processo. Al giorno d’oggi il mercato propone una serie di strumenti estremamente potenti e molti di questi vengono forniti gratuitamente a studenti universitari. Qui di seguito verranno elencati i tool utilizzati e verrà fornita una breve descrizione delle loro peculiarità.</p>
<section id="trello" data-number="2.2.0.0.1">
<h5 data-number="2.2.0.0.1"><span class="header-section-number">2.2.0.0.1</span> Trello</h5>
<p>Trello è un tool web di carattere manageriale basato sullo stile a Kanban. La struttura di una Kanban board è molto semplice:</p>
<ul class="incremental">
<li><p><span><strong>Colonne:</strong></span> Rappresentano gli <strong>stadi</strong> di un determinato processo. Nella versione più snella il processo segue tre semplici fasi: <em>ToDo, Doing</em> e <em>Done</em>, mentre nell’ambito dello sviluppo software questo può introdurre anche le fasi di sviluppo stesse come: <em>review, backlog, doc, ecc</em>.</p></li>
<li><p><span><strong>Cards:</strong></span> Gli <strong>items</strong> in una Kanban board sono rappresentati da carte. Ogni carta contiene una serie di informazioni relative a un <strong>task</strong> come: <em>durata, effort, ecc</em>.</p></li>
<li><p><span><strong>Swimlanes:</strong></span> In alcuni casi una Kanban board può essere integrata con il concetto di <strong>Gantt Chart</strong> connettendo così ogni singolo <strong>task</strong> a un determinato <strong>membro</strong> del team.</p></li>
</ul>
</section>
<section id="gantt-chart" data-number="2.2.0.0.2">
<h5 data-number="2.2.0.0.2"><span class="header-section-number">2.2.0.0.2</span> Gantt Chart</h5>
<p>Il Gantt è molto utile nella fase di <strong>assegnamento</strong> dei vari task, esso permette infatti di poter fornire una stima temporale per ogni task permettendo così di avere un controllo totale sulla <strong>schedula</strong>. Inoltre unire il Gantt a un’approccio Kanban ci ha permesso di calcolare eventuali <strong>ritardi</strong> relativi ad ogni singolo task.</p>
</section>
<section id="github-project-management" data-number="2.2.0.0.3">
<h5 data-number="2.2.0.0.3"><span class="header-section-number">2.2.0.0.3</span> Github Project Management</h5>
<p>I <strong>DVCS</strong> negli ultimi anni sono passati dal-l’essere semplici gestori di codice a veri e propri gestori di progetto. <strong>Github</strong> è stato uno dei primi a partecipare a questa transizione e ha integrato nel tempo una serie di tool estremamente interessanti.</p>
<ul class="incremental">
<li><p><span><strong>Organizzazioni:</strong></span> In Github c’è la possibilità di creare gruppi eterogenei facenti riferimento ad una organizzazione (reale o fittizia). Nel nostro caso è stata creata una organizzazione chiamata <code>Unibo-PPS-1920</code> che va a richiamare un <strong>gruppo fittizio</strong> dedicato al corso di Paradigmi di Programmazione e Sviluppo.</p></li>
<li><p><span><strong>Teams:</strong></span> Una volta definita una organizzazione è possibile creare all’inter-no di essa una serie di sottogruppi chiamati <strong>teams</strong>. Ogni team idealmente rappresenta uno <strong>Scrum Team</strong> costituito all’interno di una organizzazione o azienda con lo scopo di <strong>portare a termine un progetto</strong>. Il team dunque idealmente dovrà attraversare tutte le fasi di costruzione, partendo da una prima fase di presentazione dei membri e arrivando fino alla definizione delle <strong>figure chiave</strong> (Scrum Master, Product Owner). Nel nostro caso il team è stato nominato <code>CaminatiCeroniGiulianiniKiade</code> al fine di rispecchiare l’aspetto democratico dello stesso.</p></li>
<li><p><span><strong>Progetto:</strong></span> I progetti reali sono generalmente proposti dall’organizzazione (<em>Senior Management</em>) e poi successivamente sono assegnati ai vari team. Nel nostro caso abbiamo voluto simulare questa situazione assegnando il progetto al team suddetto. Al fine di mantenere una corretta separazione di contenuti si è deciso di creare due progetti: uno dedicato agli <strong>aspetti di documentazione</strong> e l’altro dedicato agli <strong>aspetti</strong> di carattere <strong>implementativo</strong>. I progetti sono sincronizzati tra loro attraverso Trello e Github Projects.</p></li>
<li><p><span><strong>Projects:</strong></span> I Github Projects sono entità presenti all’interno dell’organiz-zazione e rappresentano una <strong>interfaccia gestionale</strong> sui vari progetti gestiti dall’organizzazione stessa. Nel nostro caso abbiamo definito un unico <strong>Github Project</strong> nel quale è stata implementata una piccola gestione di progetto a <strong>livello operativo</strong>. Al progetto infatti, sono delegati i compiti relativi alla gestione delle <strong>Issues</strong> e delle <strong>Pull Requests</strong> permettendo agli utenti di avere sotto controllo le <strong>azioni</strong> principali svolte dal <strong>DVCS</strong>.</p></li>
</ul>
</section>
<section id="telegram" data-number="2.2.0.0.4">
<h5 data-number="2.2.0.0.4"><span class="header-section-number">2.2.0.0.4</span> Telegram</h5>
<p>Relativamente agli aspetti di <strong>comunicazione informale</strong> si è optato per uno strumento di messaggistica estremamente versatile: <strong>Telegram</strong>. Grazie a Telegram e ai famosi telegram bots è stato possibile avere aggiornamenti diretti dal DVCS e CI consentendo un maggiore <strong>controllo</strong> su tutta la fase di <strong>gestione e sviluppo</strong> del progetto.</p>
</section>
<section id="discord" data-number="2.2.0.0.5">
<h5 data-number="2.2.0.0.5"><span class="header-section-number">2.2.0.0.5</span> Discord</h5>
<p>Discord è stato utilizzato come strumento di <strong>comunicazione</strong> <strong>semi-formale</strong> <code>VoIP</code>. Su Discord è stato possibile chiarire dubbi e definire al meglio i task assegnati ai vari membri.</p>
</section>
<section id="teams" data-number="2.2.0.0.6">
<h5 data-number="2.2.0.0.6"><span class="header-section-number">2.2.0.0.6</span> Teams</h5>
<p>Microsoft Teams è una piattaforma di comunicazione e collaborazione unificata che combina chat di lavoro persistente, teleconferenza, condivisione di contenuti. Come si può notare da questa definizione Teams è uno strumento di <strong>comunicazione</strong> estremamente <strong>formale</strong> ed è stato dunque utilizzato come <strong>host principale</strong> per le <strong>riunioni Scrum</strong>.</p>
</section>
<section id="notion" data-number="2.2.0.0.7">
<h5 data-number="2.2.0.0.7"><span class="header-section-number">2.2.0.0.7</span> Notion</h5>
<p>Notion è un’applicazione a tutto tondo che fornisce supporto per quanto riguarda <strong>gestione di task</strong> e definizione di <strong>ToDo lists</strong>. È molto utile nella fase di <strong>definizione</strong> e <strong>decomposizione</strong> del <strong>Product Backlog</strong>.</p>
</section>
</section>
<section id="continuous-integration-e-automatizzazione" data-number="2.3">
<h2 data-number="2.3"><span class="header-section-number">2.3</span> Continuous Integration e Automatizzazione</h2>
<p>Gli aspetti di <strong>automatizzazione</strong> di processi ripetitivi sono estremamente importanti al fine di risparmiare tempo e migliorare la gestione di progetto. Al giorno d’oggi sempre più servizi forniscono supporti di continuous integration e gran parte di essi garantiscono all’utente un <strong>elevato</strong> grado di <strong>libertà</strong> per quanto riguarda gli aspetti di progetto da automatizzare.</p>
<p>Nel nostro caso approcci di automatizzazione sono stati impiegati per fornire supporto a due ambiti fondamentali:</p>
<section id="gestione-di-progetto-1" data-number="2.3.0.0.1">
<h5 data-number="2.3.0.0.1"><span class="header-section-number">2.3.0.0.1</span> Gestione di Progetto</h5>
<p>Gran parte degli aspetti del project management sono legati al concetto di controllo sulle <strong>fasi di progetto</strong> (Planning, Scoping ecc). Una delle problematiche fondamentali risiede in un <strong>accesso fruibile</strong> e <strong>facilitato</strong> da parte del team allo stato attuale del progetto. Grazie alla CI è possibile notificare l’intero team sullo stato attuale del progetto garantendo così maggiore <strong>consistenza</strong> e <strong>consapevolezza</strong>.</p>
<section id="tool-utilizzati" data-number="2.3.0.0.1.1">
<h6 data-number="2.3.0.0.1.1"><span class="header-section-number">2.3.0.0.1.1</span> Tool utilizzati</h6>
<p>Gran parte dei tool di gestione utilizzati forniscono <strong>API</strong> che possono essere interrogate da servizi esterni. Questo è il caso di Trello che fonisce un’ottima integrazione con <strong>IFTTT</strong> e di conseguenza con svariati servizi collegabili a quest’ultimo. Nel nostro caso è stato utilizzato IFTTT in accoppiata a <strong>Telegram</strong> al fine di fornire <strong>notifiche real-time</strong> sullo stato di progetto.</p>
</section>
</section>
<section id="gestione-di-sviluppo" data-number="2.3.0.0.2">
<h5 data-number="2.3.0.0.2"><span class="header-section-number">2.3.0.0.2</span> Gestione di Sviluppo</h5>
<p>La CI esprime il suo massimo potenziale nella <strong>fase di sviluppo</strong>. In questo caso le funzioni fornite sono state espanse permettendo di integrare il concetto di <strong>notifica</strong> a fronte di azioni effettuate dai membri del team.</p>
<section id="tool-utilizzati-1" data-number="2.3.0.0.2.1">
<h6 data-number="2.3.0.0.2.1"><span class="header-section-number">2.3.0.0.2.1</span> Tool utilizzati</h6>
<p>Per quanto riguarda la gestione di sviluppo ci si è affidati ai classici sistemi di CI integrati con il DVCS utilizzato. Nella nostra situazione è stato scelto il sistema <strong>Travis</strong> poiché garantisce un’ottima integrazione con il DVCS Github e permette inoltre di personalizzare a fondo le <strong>pipeline di integrazione</strong>. Travis è stato utilizzato come strumento di CI in due casistiche differenti:</p>
<ul class="incremental">
<li><p><span><strong>Relazione di Progetto:</strong></span> Travis è stato associato al repository contenente i sorgenti LaTeX della relazione. La configurazione è stata scritta definendo due <strong>stage condizionali</strong> e uno <strong>stage di deploy</strong>:</p>
<ol class="incremental">
<li><p><span><em><strong>Telegram notification:</strong></em></span> dedicato all’invio di <strong>notifiche</strong> a fronte di azioni di tipo <strong>push</strong> (non taggate) da parte dei membri del team.</p></li>
<li><p><span><em><strong>Latex build:</strong></em></span> dedicato alla compilazione del codice LaTeX mediante un’opportuna immagine <strong>Docker</strong> di <code>TexLive</code></p></li>
<li><p><span><em><strong>Deploy:</strong></em></span> dedicato al <strong>deploy su Github</strong> del pdf compilato precedentemente da <code>Latex build</code>. È stato infine definito un piccolo script che si occupa dell’invio di una <strong>notifica Telegram</strong> al team contenente il <strong>link al pdf</strong> rilasciato.</p></li>
</ol></li>
<li><p><span><strong>Progetto Principale:</strong></span> Travis è stato utilizzato anche nel progetto principale, definendo due stage: <strong>Check</strong> e <strong>Deploy</strong>.</p>
<ol class="incremental">
<li><p><em><strong>Check:</strong></em> durante questa fase viene chiamato il <em>Check</em> di <strong>Gradle</strong> e vengono generati <strong>report</strong> e <strong>build</strong>. Viene inoltre creata la <strong>dashboard</strong> che consiste in un file <strong>html</strong> che riunisce <strong>tutti</strong> i report.</p></li>
<li><p><em><strong>Deploy:</strong></em> il deploy viene eseguito solo nel caso in cui si faccia una push su un <strong>branch</strong> con <strong>tag</strong>. <strong>Prima</strong> di esso vengono eseguite le seguenti operazioni:</p>
<ol class="incremental">
<li><p><em>Assemble:</em> viene chiamata la <code>assemble</code> di <strong>Gradle</strong>, che si occupa di creare i file <code>.jar</code> che devono essere caricati sul <strong>repository</strong> GitHub.</p></li>
<li><p><em>Scaladoc:</em> viene generata la <strong>Scaladoc</strong>, che viene mantenuta in <strong>locale</strong>.</p></li>
<li><p><em>Report:</em> <strong>docs</strong> e <strong>report</strong> vengono copiati all’interno di una cartella <code>report</code> che conterrà un file <code>index.html</code> che li riunirà. I <strong>report</strong> comprendono: i risultati dei <strong>test</strong>, le percentuali di <strong>coverage</strong> e l’albero delle <strong>dipendenze</strong>.</p></li>
</ol>
<p><strong>Successivamente</strong> si passa al vero e proprio stage di Deploy che effettua la <strong>release</strong> di tutti i file <code>.jar</code> creati dal task <code>assemble</code> di Gradle su GitHub e procede a <strong>linkare</strong> la <strong>Dashboard</strong> creata nella cartella report con le <strong>pages</strong> di GitHub.</p></li>
</ol>
<p>Nella configurazione di <strong>Travis</strong> è stato sfruttato <strong>Gradle</strong>. La versione base (3.4.1) è stata arricchita con diversi <strong>plugin</strong>:</p>
<ul class="incremental">
<li><p><em><strong>Java:</strong></em> aggiunge la possibilità di <strong>compilare</strong> e <strong>testare</strong> sorgenti Java</p></li>
<li><p><em><strong>Java Library:</strong></em> espande il plugin Java fornendo delle <strong>conoscenze specifiche</strong> riguardanti le librerie.</p></li>
<li><p><em><strong>Scala:</strong></em> un’estensione del plugin Java per la <strong>compilazione</strong> e il <strong>testing</strong> dei sorgenti <strong>Scala</strong></p></li>
<li><p><em><strong>Jacoco:</strong></em> per la creazione del report sulla <strong>coverage</strong> dei sorgenti <strong>Scala</strong>; utilizzato in sostituzione del più adatto plugin <strong>Scoverage</strong> che non è però compatibile con Scala 2.13 su Gradle.</p></li>
<li><p><em><strong>Application:</strong></em> facilita la creazione di un <strong>eseguibile</strong> JVM, rendendo più semplice l’esecuzione dell’applicazione in <strong>locale</strong> durante la fase di sviluppo.</p></li>
<li><p><em><strong>Project Report:</strong></em> fornisce al progetto dei <strong>task</strong> per la generazione delle informazioni relative al progetto. Di questi è stato utilizzato il <strong>dependency task</strong>, per la generazione dell’albero delle dipendenze.</p></li>
<li><p><em><strong>Build Dashboard:</strong></em> viene utilizzato per la generazione di un singolo file <code>.html</code> che verrà poi utilizzato per linkare i <strong>report</strong> e la <strong>scaladoc</strong>.</p></li>
<li><p><em><strong>Shadow:</strong></em> serve per collassare tutte le <strong>dipendenze</strong> del progetto in un singolo <code>.jar</code></p></li>
<li><p><em><strong>Sensitive Semantic Versioning:</strong></em> viene utilizzato per fare <strong>semantic versioning</strong> in modo che ad ogni <code>jar</code> prodotto venga assegnato lo <strong>stesso nome</strong> del tag della relativa <strong>release</strong> fornito da Git.</p></li>
</ul></li>
</ul>
</section>
</section>
</section>
</section>
<section id="analisi-dei-requisiti" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Analisi dei Requisiti</h1>
<p>In questa fase sono stati individuati i <strong>requisiti</strong> del sistema, partendo da una descrizione di <strong>alto livello</strong>, ottenuta mettendosi nei panni di un committente, e procedendo con un <strong>raffinamento</strong> che ha portato alla definizione di requisiti più <strong>specifici</strong>, <strong>chiari</strong> e <strong>strutturati</strong>.</p>
<section id="requisiti-di-business" data-number="3.1">
<h2 data-number="3.1"><span class="header-section-number">3.1</span> Requisiti di Business</h2>
<p>Si definiscono di seguito i requisiti che dovrà avere il sistema visti ad un <strong>alto livello</strong> di astrazione e le <strong>aspettative</strong> di un potenziale committente sul risultato finale.</p>
<ul class="incremental">
<li><p>Il sistema dovrà essere una replica del gioco arcade <strong>Motos</strong> (by Namco).</p>
<ul class="incremental">
<li><p>Il gioco si svolge all’interno di un <strong>piano</strong> immerso nello spazio, che rappresenta il campo di gioco. All’interno del piano si muovono delle <strong>navicelle</strong>.</p></li>
<li><p>Il giocatore ha il <strong>comando</strong> di una delle navicelle e ha l’obiettivo di spingere tutte le navicelle nemiche <strong>fuori</strong> dal campo attraverso <strong>collisioni</strong> che generano urti elastici.</p></li>
<li><p>Sul campo sono presenti altre entità, al di fuori delle navicelle, che permettono all’utente di ottenere dei <strong>power-up</strong>.</p></li>
<li><p>Il giocatore ottiene una <strong>vittoria</strong> se non sono più presenti navicelle nemiche sull’arena e va incontro alla <strong>sconfitta</strong> se esce <strong>fuori</strong> dalla griglia per distrazione o perché spinto da un’altra navicella.</p></li>
</ul></li>
<li><p>Il sistema dovrà mettere a disposizione un <strong>menu</strong> che permetta:</p>
<ul class="incremental">
<li><p>La selezione della <strong>difficoltà</strong> di gioco</p></li>
<li><p>La possibilità di modificare il <strong>volume</strong> e <strong>attivare/disattivare</strong> la musica di sottofondo</p></li>
<li><p>La visualizzazione della lista dei <strong>punteggi migliori</strong> ottenuti nelle partite precedenti.</p></li>
<li><p>La scelta della <strong>modalità</strong> di gioco</p></li>
</ul></li>
<li><p>Il sistema dovrà permettere all’utente di usufruire di un <strong>gioco piacevole</strong>, senza interruzioni involontarie, ritardi nelle azioni e altri elementi che possano rovinare l’esperienza di gioco.</p></li>
</ul>
</section>
<section id="requisiti-utente" data-number="3.2">
<h2 data-number="3.2"><span class="header-section-number">3.2</span> Requisiti Utente</h2>
<p>Per l’utente dovrà essere possibile svolgere le seguenti attività:</p>
<ul class="incremental">
<li><p>Interagire con il sistema tramite un’<strong>interfaccia grafica</strong> intuitiva;</p></li>
<li><p><strong>Giocare:</strong></p>
<ul class="incremental">
<li><p>Avviare una sessione di gioco <strong>single-player</strong>;</p></li>
<li><p>Avviare una sessione di gioco <strong>multi-player</strong></p>
<ul class="incremental">
<li><p>selezionare un server a cui connettersi;</p></li>
</ul></li>
<li><p>Scegliere ad ogni partita la <strong>difficoltà</strong> di gioco;</p></li>
<li><p><strong>Giocare</strong> attivamente inviando al sistema appositi <strong>comandi</strong>;</p></li>
</ul></li>
<li><p>Accedere alle <strong>impostazioni</strong> e modificarle;</p></li>
<li><p>Visualizzare le <strong>statistiche</strong> di gioco.</p></li>
</ul>
<figure>
<embed src="Diagrams/useCaseDiagram.pdf" id="fig:figure1" /><figcaption>Diagramma dei casi d’uso che evidenzia le operazioni che dovranno poter essere svolte dall’utente<span label="fig:figure1"></span></figcaption>
</figure>
</section>
<section id="requisiti-funzionali" data-number="3.3">
<h2 data-number="3.3"><span class="header-section-number">3.3</span> Requisiti Funzionali</h2>
<p>Si elencano i requisiti funzionali per ognuno dei seguenti macro-componenti:</p>
<ul class="incremental">
<li><p><strong>Gioco</strong></p></li>
<li><p><strong>Multiplayer</strong></p></li>
<li><p><strong>Impostazioni</strong></p></li>
<li><p><strong>Statistiche</strong></p></li>
</ul>
<section id="gioco" data-number="3.3.1">
<h3 data-number="3.3.1"><span class="header-section-number">3.3.1</span> Gioco</h3>
<p>Il gioco deve rispecchiare le meccaniche di base dell’originale. Sono presenti diverse entità, ognuna con caratteristiche specifiche:</p>
<ul class="incremental">
<li><p><strong>Navicella</strong>: la navicella pilotata dal giocatore dovrà:</p>
<ul class="incremental">
<li><p><strong>Spostarsi</strong> all’interno del campo di gioco 2D in base agli <strong>input</strong> ricevuti da tastiera</p></li>
<li><p>Avere una <strong>massa</strong> che influisce sull’<strong>urto</strong> con gli altri elementi in campo</p></li>
<li><p>Potersi <strong>scontrare</strong> con le altre navicelle generando un urto elastico che spinge entrambi e che <strong>non</strong> tiene conto della <strong>velocità</strong> (come nel gioco originale)</p></li>
<li><p>(opzionale) Avere una <strong>durata vitale</strong> che si decrementa ad ogni urto e il quale esaurimento comporta l’<strong>eliminazione</strong>.</p></li>
</ul></li>
<li><p><strong>Navicella nemica</strong>: le navicelle nemiche in campo, controllate dal sistema, dovranno:</p>
<ul class="incremental">
<li><p>Muoversi in base a <strong>regole predefinite</strong>.</p></li>
<li><p>Avere l’obiettivo di <strong>eliminare</strong> la navicella del giocatore</p></li>
<li><p>(opzionale) Avere una <strong>durata vitale</strong> il quale esaurimento comporta l’eliminazione.</p></li>
<li><p>Seguire delle <strong>strategie</strong>. Un esempio di strategia potrebbe essere accerchiare la navicella dell’utente per spingerla fuori dal campo di gioco.</p></li>
</ul></li>
<li><p><strong>Entità power-up</strong>(opzionale): sul campo di gioco dovranno comparire degli elementi che tramite un’<strong>interazione</strong> con la navicella pilotata dal giocatore potranno fornirle dei <strong>power-up</strong>.</p>
<ul class="incremental">
<li><p><strong>Aumento della massa</strong>: la massa influisce sull’urto; aumentandola il giocatore ottiene il vantaggio di prevalere in caso di collisione, spingendo l’oggetto più lontano.</p></li>
<li><p><strong>Aumento della velocità</strong>: la velocità viene ignorata nel calcolo della spinta generata da una collisione, tuttavia il suo incremento può essere utile per sfuggire ai nemici più lenti.</p></li>
<li><p><strong>Vita aggiuntiva</strong>: permette alla navicella dell’utente di guadagnare un tentativo in più in caso di sconfitta.</p></li>
<li><p><strong>Rimozione dei power-up</strong>: reimposta la massa e la velocità a quelle di default.</p></li>
<li><p><strong>Incremento del punteggio</strong>: è contenuto in degli elementi che possono essere spinti fuori dal campo come le navicelle e assegnano un punteggio se eliminati dal campo di gioco.</p></li>
</ul></li>
<li><p><strong>Giocatore</strong>: il giocatore è l’entità principale, intorno alla quale ruotano le dinamiche di gioco.</p>
<ul class="incremental">
<li><p>Il giocatore può <strong>controllare</strong> una navicella</p></li>
<li><p>Accumula <strong>punti</strong> eliminando le altre navicelle e, opzionalmente, interagendo con le entità power-up</p></li>
<li><p>Ha un determinato numero di <strong>vite</strong>, che rappresentano il numero di volte in cui si può riprendere il gioco dopo essere stati eliminati, senza che venga fatto un <strong>reset</strong> dello stato</p></li>
<li><p>Ha l’obiettivo di <strong>eliminare</strong> le navicelle nemiche</p></li>
</ul></li>
<li><p><strong>Arena di gioco</strong>: è lo <strong>spazio</strong> su cui si muovono gli elementi del gioco.</p>
<ul class="incremental">
<li><p>Si compone di un piano <strong>bidimensionale</strong> suddiviso da una <strong>griglia</strong> che rappresenta le <em>piastrelle</em> dell’arena.</p></li>
<li><p>(opzionale) L’arena può presentare al suo interno delle <em>piastrelle</em> <strong>mancanti</strong> che non fanno parte del campo di gioco e che comportano quindi l’eliminazione delle navicelle che le attraversano.</p></li>
<li><p>Ha dei <strong>bordi</strong> ben definiti che la delimitano dall’area circostante e che se attraversati da una navicella ne comportano l’eliminazione.</p></li>
</ul></li>
</ul>
</section>
<section id="multiplayer" data-number="3.3.2">
<h3 data-number="3.3.2"><span class="header-section-number">3.3.2</span> Multiplayer</h3>
<p>Opzionalmente il gioco sarà fruibile anche in modalità <strong>Multiplayer</strong>. La modalità Multiplayer dovrà permettere a <strong>più giocatori</strong> di interagire all’interno della <strong>stessa arena</strong>.<br />
Il multiplayer potrà essere di <strong>due tipi</strong>:</p>
<ul class="incremental">
<li><p><strong>Cooperativo</strong>: i giocatori sono <strong>alleati</strong> e hanno l’obiettivo di eliminare le navicelle pilotate dal sistema.</p>
<ul class="incremental">
<li><p>Le condizioni di <strong>vittoria</strong> saranno:</p>
<ul class="incremental">
<li><p><strong>Eliminazione</strong> delle navicelle <strong>nemiche</strong></p></li>
<li><p><strong>Sopravvivenza</strong> di almeno una delle navicelle <strong>alleate</strong>.</p></li>
</ul></li>
<li><p>I giocatori andranno incontro alla <strong>sconfitta</strong> se:</p>
<ul class="incremental">
<li><p>Sul campo rimangono <strong>solo</strong> le navicelle nemiche</p></li>
</ul></li>
</ul></li>
<li><p><strong>Competitivo</strong>: i giocatori sono <strong>avversari</strong> e ognuno di loro ha l’obiettivo di rimanere l’<strong>unica</strong> navicella sul campo.</p>
<ul class="incremental">
<li><p>Le condizioni di <strong>vittoria</strong> saranno:</p>
<ul class="incremental">
<li><p><strong>Eliminazione</strong> delle navicelle pilotate dal <strong>sistema</strong>.</p></li>
<li><p><strong>Eliminazione</strong> delle navicelle pilotate da altri <strong>giocatori</strong>.</p></li>
</ul></li>
<li><p>I giocatori andranno incontro alla <strong>sconfitta</strong> se:</p>
<ul class="incremental">
<li><p>La navicella da loro pilotata <strong>esce</strong> dal campo di gioco</p></li>
<li><p>(opzionale) I <strong>punti vita</strong> della loro navicella arrivano a <strong>zero</strong> per aver subito danni</p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="impostazioni" data-number="3.3.3">
<h3 data-number="3.3.3"><span class="header-section-number">3.3.3</span> Impostazioni</h3>
<p>Deve essere prevista la possibilità di gestire le impostazioni che riguardano l’ambiente dentro il quale si trova il gioco.<br />
Le <strong>impostazioni</strong> disponibili saranno le seguenti:</p>
<ul class="incremental">
<li><p><strong>Musica</strong>: deve essere possibile <strong>attivare</strong> o <strong>disattivare</strong> la musica di sottofondo.</p></li>
<li><p><strong>Volume</strong>: l’utente deve poter <strong>regolare</strong> il volume della musica di sottofondo.</p></li>
</ul>
</section>
<section id="statistiche" data-number="3.3.4">
<h3 data-number="3.3.4"><span class="header-section-number">3.3.4</span> Statistiche</h3>
<p>Dovranno essere disponibili delle statistiche, basate sulle <strong>partite precedenti</strong> in modalità single player. Le statistiche dovranno mostrare i <strong>record</strong> raggiunti dai giocatori; in particolare verranno visualizzate le seguenti informazioni:</p>
<ul class="incremental">
<li><p><strong>Posizione</strong> in classifica.</p></li>
<li><p><strong>Username</strong> dell’utente che detiene quel record.</p></li>
<li><p><strong>Punteggio</strong> totalizzato in quella circostanza.</p></li>
</ul>
<p>Alla vittoria da parte di un giocatore, nel caso in cui il suo punteggio gli consentisse il piazzamento in classifica, avrà l’opzione di inserire il suo nome utente, al fine di registrare il punteggio raggiunto in classifica.</p>
</section>
</section>
<section id="requisiti-non-funzionali" data-number="3.4">
<h2 data-number="3.4"><span class="header-section-number">3.4</span> Requisiti non Funzionali</h2>
<p>Il sistema dovrà rispettare alcuni requisiti non funzionali che ne determineranno la <strong>qualità</strong>:</p>
<ul class="incremental">
<li><p><strong>Reattività</strong>: l’utente non deve percepire <strong>ritardi</strong> tra l’invio di un comando e l’esecuzione dello stesso da parte del gioco, il feedback grafico deve essere immediato.</p></li>
<li><p><strong>Prestazioni</strong>: devono essere tenute particolarmente in considerazione le <strong>performance</strong> affinché il gioco risulti fluido.</p></li>
<li><p><strong>Scalabilità</strong>: in caso venga gestita la modalità multiplayer, il gioco deve essere <strong>scalabile</strong> per poter supportare la gestione più client.</p></li>
<li><p><strong>Fault tollerance</strong>: la <strong>gestione degli errori</strong> deve essere adeguatamente implementata affinché le interruzioni involontarie del gioco avvengano solo in casi particolari.</p></li>
</ul>
</section>
<section id="requisiti-implementativi" data-number="3.5">
<h2 data-number="3.5"><span class="header-section-number">3.5</span> Requisiti Implementativi</h2>
<p>Si definiscono i <strong>constraint</strong> a livello di implementazione che sarà necessario rispettare nella realizzazione del progetto.</p>
<section id="scala" data-number="3.5.1">
<h3 data-number="3.5.1"><span class="header-section-number">3.5.1</span> Scala</h3>
<p>Il gioco deve essere realizzato utilizzando un linguaggio funzionale <strong>JVM-based</strong>, preferibilmente il linguaggio <strong>Scala</strong> che è stato trattato in maniera approfondita durante il corso di Paradigmi di Programmazione e Sviluppo.</p>
</section>
</section>
</section>
<section id="design-architetturale" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Design Architetturale</h1>
<p>Dopo un’attenta analisi dei requisiti, si è proceduto con la fase di <strong>design architetturale</strong> che si è sviluppata in più passi, partendo dalla definizione ad alto livello di un’architettura generale e <strong>raffinandola</strong> gradualmente.</p>
<section id="architettura-generale" data-number="4.1">
<h2 data-number="4.1"><span class="header-section-number">4.1</span> Architettura Generale</h2>
<p>Il primo passo per quanto riguarda l’aspetto della <strong>progettazione</strong> è consistito nella ricerca dei pattern più adatti da applicare, nell’individuazione dei principali componenti dell’<strong>architettura generale</strong>, e nella definizione dei modi in cui essi interagiscono.</p>
<p>La seguente immagine (fig: <a href="#fig:architectureClassDiagram" data-reference-type="ref" data-reference="fig:architectureClassDiagram">4.1</a>) definisce il <strong>core</strong> dell’architettura generale che è stato successivamente <strong>ampliato</strong> per gestire anche la parte di architettura <strong>client-server</strong> necessaria alla realizzazione della modalità <strong>multiplayer</strong>.</p>
<figure>
<embed src="plantuml/rendered/classDiagrams/architectureClassDiagram.pdf" id="fig:architectureClassDiagram" /><figcaption>Diagramma raffigurante le entità principali dell’architettura e le loro interazioni ad un alto livello di astrazione.<span label="fig:architectureClassDiagram"></span></figcaption>
</figure>
<p>Spiegazione breve delle entità in gioco</p>
<ul class="incremental">
<li><p><strong>View:</strong> ha l’obbiettivo di fornire all’utente una <strong>schermata</strong> intuitiva per il controllo del gioco.</p></li>
<li><p><strong>Controller:</strong> rappresenta il punto di <strong>snodo</strong> per la gestione della logica principale dell’applicazione. La sua funzione primaria è quella di gestire la <strong>comunicazione</strong> tra: View, ECS, e GameEngine.</p></li>
<li><p><strong>ECS:</strong> è un aggregato di <strong>sistemi</strong>, <strong>entità</strong> e <strong>componenti</strong> che esprimono e contengono in maniera astratta la logica di gioco.</p></li>
<li><p><strong>GameEngine:</strong> rappresenta il cuore del gioco; incapsula il flusso di controllo principale e tramite ECS calcola continuamente il nuovo ambiente.</p></li>
</ul>
</section>
<section id="pattern-architetturali-utilizzati" data-number="4.2">
<h2 data-number="4.2"><span class="header-section-number">4.2</span> Pattern Architetturali Utilizzati</h2>
<section id="ecs" data-number="4.2.1">
<h3 data-number="4.2.1"><span class="header-section-number">4.2.1</span> ECS</h3>
<p>Trattandosi dello sviluppo di un videogioco, per il quale è necessario creare un motore di gioco, è stato scelto di utilizzare il pattern architetturale <strong>Entity-Component-System</strong> (ECS). Questo pattern è largamente utilizzato nello svi-luppo di videogiochi per motivi di performance e per la sua estensibilità e manutenibilità.</p>
<p>ECS si compone di tre parti principali:</p>
<ul class="incremental">
<li><p><strong>Entità:</strong> rappresentano gli elementi in gioco, ad esempio Bumper car, PowerUp o Enemy. Ad ogni entità vengono associati uno o più componenti.</p></li>
<li><p><strong>Componenti:</strong> sono delle proprietà che vengono possedute da una o più entità e ne rappresentano lo stato. Esempi di possibili componenti sono direzione o posizione.</p></li>
<li><p><strong>Sistemi:</strong> definiscono dei comportamenti necessari a gestire dei sottoinsiemi della logica di gioco. Gestiscono le interazioni tra le entità agendo sui componenti associati ad esse.</p></li>
</ul>
</section>
<section id="mvc" data-number="4.2.2">
<h3 data-number="4.2.2"><span class="header-section-number">4.2.2</span> MVC</h3>
<p>Il pattern <strong>MVC</strong> rappresenta uno standard per quanto riguarda il <strong>design</strong> di applicazioni <em>robuste</em> ed <em>estendibili</em>. Nel nostro caso il pattern è stato utilizzato in concomitanza con il pattern <strong>ECS</strong> permettendo così di raggiungere una maggiore <strong>separazione dei concetti</strong>. L’MVC progettato si compone dei seguenti moduli:</p>
<ul class="incremental">
<li><p><strong>Model:</strong> All’interno del nostro applicativo esistono due tipi di modello:</p>
<ul class="incremental">
<li><p><strong>Game Model:</strong> Il <strong>modello di gioco</strong> rappresenta l’insieme delle <strong>strutture dati</strong> utili per modellare il gameplay. Nel nostro caso questo compito è stato catturato interamente dal <strong>pattern ECS</strong>.</p></li>
<li><p><strong>Application Logic Model:</strong> Il modello della <strong>logica applicativa</strong> riguarda tutti i dati utili al <strong>corretto funzionamento</strong> dell’applica-zione (Impostazioni, Livelli, Dati utente, ecc).</p></li>
</ul></li>
<li><p><strong>View:</strong> L’interfaccia grafica si configura come un <strong>punto di intersezione</strong> fra <strong>ECS</strong> e <strong>MVC</strong> per quanto riguarda gli aspetti dell’interazione utente. Essa si compone di due tipologie di schermate:</p>
<ul class="incremental">
<li><p><strong>Game Screen:</strong> È una schermata di gioco connessa interamente al modulo ECS. Essa ha come scopo principale quello di mostrare gli <strong>aggiornamenti di gioco</strong> e acquisire i <strong>comandi</strong> da parte dell’utente.</p></li>
<li><p><strong>Application Screen:</strong> È istanza di una semplice <strong>schermata di presentazione</strong>. Lo scopo di una application screen consiste essenzialmente nel garantire all’utente una buona <strong>usabilità</strong> e <strong>interazione</strong> col sistema, incapsulando le informazioni di modello in una <strong>visualizzazione fruibile</strong>.</p></li>
</ul></li>
<li><p><strong>Controller:</strong> Gestisce le <strong>interazioni</strong> fra i principali moduli dell’architet-tura e mette a disposizione una serie di <strong>funzionalità</strong> relative alla <strong>gestione delle risorse</strong>.</p></li>
</ul>
</section>
<section id="subsec:client_server" data-number="4.2.3">
<h3 data-number="4.2.3"><span class="header-section-number">4.2.3</span> Client-Server</h3>
<p>Un’architettura di tipo client-server si è resa necessaria per poter gestire la modalità di gioco <strong>multiplayer</strong>. Il sistema deve infatti permettere ad un utente di <strong>ospitare</strong> una partita assumendo il ruolo di <code>server</code> e ad altri utenti di <strong>partecipare</strong> ricoprendo il ruolo di <code>client</code>.</p>
<section id="scelta-del-paradigma" data-number="4.2.3.1">
<h4 data-number="4.2.3.1"><span class="header-section-number">4.2.3.1</span> Scelta del paradigma</h4>
<p>Per gestire l’interazione tra Client e Server si è ritenuto adatto l’utilizzo del <strong>paradigma ad attori</strong> applicato mediante la modellazione di un attore <code>Server</code> e un attore <code>Client</code> che interagiscono tramite scambio di <strong>messaggi</strong>.</p>
</section>
<section id="distribuito-vs-centralizzato" data-number="4.2.3.2">
<h4 data-number="4.2.3.2"><span class="header-section-number">4.2.3.2</span> Distribuito vs centralizzato</h4>
<p>Quando ci si cimenta nella progettazione di un sistema che si interfaccerà in <strong>rete</strong> è necessario definire quale <strong>approccio</strong> utilizzare. Essenzialmente vi sono due strade percorribili: una basata su uno schema <strong>centralizzato</strong> mentre l’altra basata su uno schema <strong>peer-to-peer</strong>.</p>
<ul class="incremental">
<li><p>Approccio centralizzato</p>
<ul class="incremental">
<li><p>Semplicità</p></li>
<li><p>Reattività</p></li>
<li><p>Consistenza</p></li>
<li><p>Single Point of Failure</p></li>
</ul></li>
<li><p>Approccio distribuito</p>
<ul class="incremental">
<li><p>Fault-tolerance</p></li>
<li><p>Carico suddiviso</p></li>
<li><p>Modulare</p></li>
<li><p>Complesso</p></li>
<li><p>Incline all’inconsistenza</p></li>
</ul></li>
</ul>
<p>Si è preferito utilizzare un approccio centralizzato anziché distribuito perché, data la natura del sistema che è da realizzare, si è ritenuto che una scelta diversa avrebbe portato, a fronte di un maggiore sforzo progettuale e implementativo, a dei risultati peggiori in termini di performance, reattività e consistenza.</p>
<p>Come mostrato dalla figura <a href="#fig:clientServerComponentDiagram" data-reference-type="ref" data-reference="fig:clientServerComponentDiagram">4.2</a> il sistema è stato progettato in modo da poter estendere l’architettura core per il multiplayer, "staccando" l’engine del client e sostituendolo con l’attore client che poi comunicherà con l’attore server, che si interfaccia direttamente con il server.</p>
<figure>
<embed src="plantuml/rendered/componentDiagrams/clientServerComponentDiagram.pdf" id="fig:clientServerComponentDiagram" /><figcaption>Diagramma raffigurante gli attori di tipo Client e Server e le loro interazioni.<span label="fig:clientServerComponentDiagram"></span></figcaption>
</figure>
</section>
</section>
</section>
<section id="scelte-tecnologiche-cruciali" data-number="4.3">
<h2 data-number="4.3"><span class="header-section-number">4.3</span> Scelte Tecnologiche Cruciali</h2>
<section id="akka" data-number="4.3.1">
<h3 data-number="4.3.1"><span class="header-section-number">4.3.1</span> Akka</h3>
<p>Per l’implementazione del paradigma ad attori sì e scelto di utilizzare <strong>Akka</strong> <span class="citation" data-cites="akkaSite">(“Akka’s Site,” n.d. akkaSite)</span> come layer di <strong>comunicazione</strong> nello sviluppo del multiplayer. Akka garantisce un’ottima <strong>scalabilità</strong> e un buon livello di <strong>astrazione</strong>, che permette di gestire la comunicazione in maniera più trasparente rispetto ai classici metodi basati sulle <strong>socket</strong>. Il modello <strong>Client-Server</strong> basato su Akka risulta così di facile <strong>implementazione</strong>.</p>
<p>Inoltre, il fatto che Akka sia implementato in <strong>Scala</strong> rende più semplice e naturale l’utilizzo del framework.</p>
</section>
</section>
</section>
<section id="design-di-dettaglio" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Design di Dettaglio</h1>
<section id="sec:ecs_design" data-number="5.1">
<h2 data-number="5.1"><span class="header-section-number">5.1</span> ECS</h2>
<p>Tradizionalmente nello sviluppo di applicazioni si tende ad utilizzare un approccio di design basato sull’<strong>ereditarietà</strong>. Questa scelta, attraverso la crea-zione di <strong>gerarchie semantiche</strong> precise (Persona -&gt; Studente), permette generalmente di ottenere implementazioni più <strong>robuste</strong> e <strong>strutturate</strong>. Nell’ambito dei videogiochi, dove è necessario un elevato grado di <strong>flessibilità</strong>, queste gerarchie strutturate possono risultare <strong>costrittive</strong>. Al fine di eliminare questa problematica nel tempo ci si è diretti verso approcci basati maggiormente sulla <strong>composizione</strong>. Il pattern architetturale <code>ECS</code> nasce proprio seguendo questa filosofia di pensiero.</p>
<section id="subsec:ecs_pattern" data-number="5.1.1">
<h3 data-number="5.1.1"><span class="header-section-number">5.1.1</span> Il pattern</h3>
<p>Il modello <strong>ECS</strong> è costituito da tre parti fondamentali: entità, componenti e sistemi.</p>
<ul class="incremental">
<li><p><span><strong>Entity:</strong></span> costituisce una <strong>rappresentazione astratta</strong> di una entità in gioco. Essa è caratterizzata in un dato momento da una serie di proprietà che possono <em>variare liberamente</em>. <em>Concettualmente</em>, pur avendo un aspetto <strong>dinamico</strong> dal punto di vista delle proprietà ad essa associate, un’entità deve rimanere <strong>fedele</strong> alla sua natura.</p>
<p>Per esempio un’entità nemica manterrà sempre la sua natura avversa al giocatore, pur avendo la possibilità di <em>modificare le sue proprietà</em>.</p></li>
<li><p><span><strong>Component:</strong></span> le proprietà associate all’entità prendono il nome di <strong>componenti</strong>. Essi sono la vera <strong>componente modulare</strong> di ECS poiché possono essere <strong>aggregati</strong> ad ogni entità in modo <strong>dinamico</strong>. La loro composizione costituisce lo <strong>stato</strong> dell’entità a cui sono associati.</p></li>
<li><p><span><strong>System:</strong></span> il sistema rappresenta il vero aspetto <strong>funzionale</strong> di ECS poiché costituisce un <em>modulo</em> dedicato unicamente alla gestione del <strong>comportamento</strong> delle singole entità. Il punto di forza del pattern sta nel fatto che ogni <strong>sistema agisce</strong> su una serie di <strong>componenti</strong> (in base alla tipologia), di conseguenza nel momento in cui un componente verrà rimosso da un’entità quest’ultima vedrà <strong>modificato</strong> il proprio comportamento.</p></li>
</ul>
</section>
<section id="approcci-di-design" data-number="5.1.2">
<h3 data-number="5.1.2"><span class="header-section-number">5.1.2</span> Approcci di design</h3>
<p>Come visto in precedenza in <a href="#subsec:ecs_pattern" data-reference-type="ref" data-reference="subsec:ecs_pattern">5.1.1</a>, l’idea alla base di ECS è molto semplice, tuttavia durante il processo di <strong>concretizzazione</strong> alcuni aspetti concettuali vengono realizzati in modo leggermente diverso per <em>esigenze di carattere implementativo</em> (performance, cache, ecc). Dal punto di vista progettuale esistono diversi <strong>approcci possibili</strong>:</p>
<ul class="incremental">
<li><p><span><strong>Approccio OOP:</strong></span> questa tipologia di approccio riprende l’idea che sta alla base della <strong>programmazione ad oggetti</strong>; in particolare viene promosso il concetto secondo il quale ogni oggetto possiede al proprio interno uno <strong>stato</strong> e un <strong>comportamento</strong>. Un ECS di tipo OOP sarà caratterizzato da entità che <strong>contengono</strong> i propri <strong>componenti</strong> e si occupano della loro <strong>gestione</strong>.</p></li>
<li><p><span><strong>Approccio Data-Driven:</strong></span> in questo caso stato e comportamento vengono mantenuti in <strong>moduli dedicati</strong> promuovendo una maggiore <strong>separazione dei concetti</strong>. L’ECS in questo caso sarà caratterizzato da <strong>moduli di gestione</strong> ai quali saranno delegati il <strong>controllo</strong> e la <strong>connessione</strong> di entità e componenti.</p></li>
</ul>
<section id="alcune-considerazioni-di-basso-livello" data-number="5.1.2.0.1">
<h5 data-number="5.1.2.0.1"><span class="header-section-number">5.1.2.0.1</span> Alcune considerazioni di basso livello:</h5>
<p>Nella definizione del pattern ECS ogni sistema si occupa di gestire solamente uno o più componenti, <strong>aggiornandoli</strong> in blocco contemporaneamente.</p>
<p>Un approccio più OOP consisterebbe nel modellare <em>ogni entità come un oggetto</em> che deve implementare una sotto-interfaccia diversa in base al tipo, ereditando, di conseguenza, i metodi per l’aggiornamento. Questo causa <strong>problemi di performance</strong> all’aumentare delle entità da gestire, poiché ad ogni aggiornamento verrebbe caricato in <strong>cache</strong> l’intero oggetto aumentando così la <strong>latenza</strong> relativa alla fase di loading. Ciò comporta un <strong>degradamento</strong> importante delle <strong>performance</strong>.</p>
</section>
</section>
<section id="design-proposto" data-number="5.1.3">
<h3 data-number="5.1.3"><span class="header-section-number">5.1.3</span> Design Proposto</h3>
<p>L’analisi delle opzioni possibili e del loro sviluppo ha portato a scegliere un approccio data-driven dato che garantisce nel complesso una maggiore <strong>estendibilità</strong> e <strong>performance</strong> migliori. L’approccio scelto inoltre si <strong>integra</strong> molto bene con il <strong>paradigma funzionale</strong> poiché permette di sfruttare al meglio le caratteristiche di quest’ultimo.</p>
<p>Il design finale ottenuto è quello raffigurato in <a href="#fig:ECS" data-reference-type="ref" data-reference="fig:ECS">5.1</a>.</p>
<figure>
<embed src="drawio/ECS/ECS.pdf" id="fig:ECS" /><figcaption>Diagramma di classe rappresentante il design proposto.<span label="fig:ECS"></span></figcaption>
</figure>
<p>Come si evince dal diagramma si è scelto di utilizzare una <strong>struttura basata su gestori</strong> (<code>Manager</code>) ognuno responsabile di un particolare aspetto di ECS. Inoltre è stato introdotto un <strong>punto di snodo</strong> (<code>Coordinator</code>) con il compito di <strong>coordinare</strong> i vari gestori. Di seguito verranno presentati i principali moduli presenti all’interno del diagramma:</p>
<ul class="incremental">
<li><p><span><strong>Core ECS:</strong></span></p>
<ul class="incremental">
<li><p><span><strong>Entity:</strong></span> rappresenta il concetto di entità classico di ECS. Nel nostro caso un’entità è rappresentata dalla propria <strong>istanza di tipo</strong> (che ne descrive la natura) e un <strong>identificatore</strong>.</p></li>
<li><p><span><strong>Component:</strong></span> rappresenta in toto il concetto di componente di ECS.</p></li>
<li><p><span><strong>System:</strong></span> costituisce un <strong>modulo passivo</strong> di gestione di entità che viene aggiornato dall’esterno (<code>update()</code>). Ogni sistema è inoltre caratterizzato da una <code>Signature</code> che corrisponde ad un <strong>insieme di componenti</strong> gestiti.</p></li>
</ul></li>
<li><p><span><strong>Manager:</strong></span></p>
<ul class="incremental">
<li><p><span><strong>Entity Manager:</strong></span> modulo dedicato alla gestione delle entità di gioco. Consiste in un <strong>accentratore</strong> per tutte le <strong>istanze</strong> di entità e si occupa del loro <strong>inserimento</strong> e <strong>rimozione</strong>.</p></li>
<li><p><span><strong>Component Manager:</strong></span> tiene traccia delle <strong>associazioni</strong> fra <strong>entità</strong> e <strong>componenti</strong> e gestisce l’<strong>aggiunta</strong> e <strong>rimozione</strong> di questi ultimi.</p></li>
<li><p><span><strong>System Manager:</strong></span> costituisce un aggregatore di sistemi e ha lo scopo di <strong>mantenere coerenti</strong> i legami fra sistema, entità e componente in base alla <strong>signature del sistema</strong>.</p></li>
</ul></li>
<li><p><span><strong>Coordinator:</strong></span> contiene la logica core di tutto l’ECS e ha lo scopo fondamentale di <strong>coordinare i manager</strong> <strong>accentrando</strong> le operazioni da essi fornite.</p></li>
</ul>
</section>
<section id="funzionamento" data-number="5.1.4">
<h3 data-number="5.1.4"><span class="header-section-number">5.1.4</span> Funzionamento</h3>
<p>Introdotto il design di dettaglio relativo ad ECS è necessario definirne il <strong>funzionamento</strong> evidenziando le interazioni.</p>
<figure>
<embed src="plantuml/rendered/sequenceDiagrams/sequenceECS.pdf" id="fig:sequenceECS" /><figcaption>Diagramma di sequenza che mostra le varie interazioni fra gli elementi di design.<span label="fig:sequenceECS"></span></figcaption>
</figure>
<p>Il diagramma in figura <a href="#fig:sequenceECS" data-reference-type="ref" data-reference="fig:sequenceECS">5.2</a> mostra le interazioni principali fra gli elementi in gioco. I passi fondamentali che vengono mostrati possono essere riassunti in pochi macro step:</p>
<ol class="incremental">
<li><p><span><strong>Registrazione dei componenti:</strong></span> un componente prima poter essere utilizzato deve essere <strong>registrato</strong> al <code>ComponentManager</code> in modo da <strong>verificare</strong> che non si utilizzino <strong>componenti diversi</strong> a runtime.</p></li>
<li><p><span><strong>Registrazione dei sistemi:</strong></span> successivamente è possibile registrare sistemi. La registrazione è molto semplice e consiste nell’assegnazione di una <code>Signature</code> al sistema. Una <code>Signature</code> non è altro che una <strong>lista di tipi di componente</strong> che definiscono la <strong>natura del sistema</strong>. Grazie a questo espediente è possibile delegare un sistema alla <strong>gestione delle entità</strong> a lui <strong>compatibili</strong>.</p></li>
<li><p><span><strong>Creazione di entità:</strong></span> in qualsiasi momento è possibile creare un’entità la cui <strong>istanza</strong> verrà conservata all’interno dell’<code>EntityManager</code>. È importante sottolineare che in questo caso l’entità non è ancora gestita da <strong>nessun sistema</strong> poiché <strong>non possiede</strong> componenti associati.</p></li>
<li><p><span><strong>Aggiunta di componenti ad entità:</strong></span> una volta che viene <strong>associato</strong> un componente ad una entità, l’entità potrà essere <strong>assegnata</strong> ai <strong>sistemi compatibili</strong> e quindi gestita.</p></li>
</ol>
</section>
</section>
<section id="sec:mediator_design" data-number="5.2">
<h2 data-number="5.2"><span class="header-section-number">5.2</span> Mediator</h2>
<p>Dopo un attento studio delle <strong>specifiche</strong> sviluppate nella fase di analisi è emerso un importante <strong>problema di interazione</strong> fra alcuni <strong>componenti cardine</strong>. Come è stato ribadito in <a href="#subsec:client_server" data-reference-type="ref" data-reference="subsec:client_server">4.2.3</a> il design è stato sviluppato cercando di tenere conto dei principali <strong>requisiti di qualità</strong> e <strong>buona progettazione</strong>. Questo grado di <strong>estendibilità</strong> e <strong>modularizzazione</strong> si è esplicitato nella defini-zione di una architettura (<code>Core</code>) <strong>espandibile a richiesta</strong> verso un modello <strong>client-server</strong> ad <strong>attori</strong> (<code>Core + Actor</code>).</p>
<p>Mantenere un <strong>core unico</strong> e <strong>polifunzionale</strong> non è semplice ed è necessario ridefinire gli elementi mobili utilizzando il cosidetto <code>loose coupling</code>.</p>
<section id="il-problema" data-number="5.2.1">
<h3 data-number="5.2.1"><span class="header-section-number">5.2.1</span> Il problema</h3>
<p>Nell’architettura core definita in fase di progettazione il problema risiede essenzialmente nella gestione del passaggio da <strong>single-player</strong> game a <strong>multiplayer</strong>.</p>
<section id="single-player" data-number="5.2.1.0.1">
<h5 data-number="5.2.1.0.1"><span class="header-section-number">5.2.1.0.1</span> Single-player:</h5>
<p>Nella versione single-player il sistema di gioco si appoggia sul cosiddetto <code>GameEngine</code> il quale è in grado di <strong>calcolare autonomamente gli aggiornamenti</strong> da inviare alla/e schermata/e di gioco.</p>
</section>
<section id="multiplayer-1" data-number="5.2.1.0.2">
<h5 data-number="5.2.1.0.2"><span class="header-section-number">5.2.1.0.2</span> Multiplayer:</h5>
<p>Nel caso multiplayer esiste un <strong>server unico</strong> a cui sono collegati una serie di <strong>client</strong>. Il server agisce da <strong>leader</strong> poiché, possedendo un <code>GameEngine</code> proprio, è in grado di calcolare gli <strong>aggiornamenti di gioco</strong> a fronte di <strong>input propri</strong> e <strong>dei client</strong>. I client, al fine di promuovere <strong>semplicità</strong>, sono stati concepiti come <strong>architetture core</strong> private del motore di calcolo <code>GameEngine</code>. Essi in poche parole si presentano come <strong>attori passivi</strong> che <strong>acquisiscono aggiornamenti</strong> dal server e li mostrano all’utente attraverso una <strong>interfaccia grafica</strong>.</p>
<p>Un approccio di questo tipo è molto utile poiché permette di poter utilizzare il server per giocare <strong>ospitando contemporaneamente la partita in corso</strong>. Inoltre promuove <strong>leggerezza</strong> e <strong>riusabilità</strong> dato che i client devono mostrare le <strong>stesse informazioni</strong> che il server produrrebbe per sé stesso in modalità single-player.</p>
</section>
<section id="da-single-player-a-multiplayer" data-number="5.2.1.0.3">
<h5 data-number="5.2.1.0.3"><span class="header-section-number">5.2.1.0.3</span> Da Single-player a Multiplayer:</h5>
<p>Il problema, come abbiamo detto, si presenta nel passaggio dalla modalità <strong>single-player</strong> a quella <strong>multiplayer</strong>. Nel caso di un passaggio a <strong>server-mode</strong> il sistema dovrà mantenere il core intatto ma dovrà aver cura di <strong>inviare gli aggiornamenti</strong> non solo all’<strong>interfaccia locale</strong> ma anche all’<strong>attore server</strong> (il quale effettuerà un broadcast ai client). Il passaggio a <strong>client-mode</strong> è ancora più delicato; in questo caso, infatti, sarà necessario spegnere il modulo <code>GameEngine</code> <strong>dirottando i flussi di informazione</strong> verso il <strong>client-actor</strong>.</p>
</section>
</section>
<section id="subsec:mediator_solution" data-number="5.2.2">
<h3 data-number="5.2.2"><span class="header-section-number">5.2.2</span> La soluzione</h3>
<p>Al fine di definire una soluzione valida ci si è appoggiati su un pattern di design di tipo comportamentale, il <strong>pattern Mediator</strong>. Il pattern consiste nella definizione di un <strong>modulo</strong> esterno a tutti gli altri il cui scopo consiste essenzialmente nella <strong>mediazione e ridirezionamento dei flussi</strong> di dati.</p>
<p>Nel nostro caso il Mediator ha lo scopo principe di <strong>mediare le interazioni</strong> fra quattro componenti fondamentali:</p>
<ul class="incremental">
<li><p><span><strong>Schermata di gioco:</strong></span> Deve essere in grado di inviare comandi al <strong>proprio</strong> <code>GameEngine</code> (single-player) oppure al <code>GameEngine</code> <strong>del server</strong> (multiplayer).</p></li>
<li><p><span><strong>Engine:</strong></span> Riceve i comandi dal proprio <code>GameScreen</code> (single-player) o dai <code>GameScreen</code> dei client e li elabora producendo un <strong>nuovo aggiornamento</strong>.</p></li>
<li><p><span><strong>Attore Client:</strong></span> Può essere concepito come un <code>Core</code> munito solo di un unico <code>GameScreen</code>.</p></li>
<li><p><span><strong>Attore Server:</strong></span> Può essere concepito come un <code>Core</code> agganciato a un numero di <code>GameScreen</code> variabile.</p></li>
</ul>
<p>Al fine di gestire al meglio le interazioni è stato scelto di implementare un <strong>approccio basato su eventi</strong> che è stato poi pensato in <strong>due versioni molto simili</strong>:</p>
<ul class="incremental">
<li><p><span><strong>Mediator Handler:</strong></span> Il <strong>Mediator</strong> è stato progettato sfruttando il <strong>pattern ad handler</strong> basato su <strong>eventi</strong>.</p></li>
<li><p><span><strong>Mediator Observer:</strong></span> Il <strong>Mediator</strong> è stato progettato sfruttando il <strong>pattern observer ad eventi</strong>.</p></li>
</ul>
<p>Come vediamo in figura <a href="#fig:mediatorHandler" data-reference-type="ref" data-reference="fig:mediatorHandler">5.3</a> la prima scelta porta come principale vantaggio l’ottenimento di <strong>performance migliori</strong> poiché ogni handler rappresenta del <strong>codice associato ad un evento immediatamente eseguibile</strong>. A questo però si aggiungono una <strong>serie di problematiche</strong> (vedi <a href="#subsubsec:mediator_handler_problem" data-reference-type="ref" data-reference="subsubsec:mediator_handler_problem">6.1.1.2.1</a>) che hanno portato a rivedere la soluzione proposta dirigendosi verso un’altra soluzione.</p>
<figure>
<embed src="drawio/mediator/mediatorHandler.pdf" id="fig:mediatorHandler" /><figcaption>Design del Mediator basato su handlers.<span label="fig:mediatorHandler"></span></figcaption>
</figure>
<p>La versione basata su handler è stata quindi rivista in un <strong>approccio</strong> maggiormente <strong>strutturato</strong> incentrato principalmente sul <strong>Pattern Observer ad eventi</strong>. (fig: <a href="#fig:mediatorObserver" data-reference-type="ref" data-reference="fig:mediatorObserver">5.4</a>).</p>
<figure>
<embed src="drawio/mediator/mediatorObserver.pdf" id="fig:mediatorObserver" /><figcaption>Design del Mediator basato su observer.<span label="fig:mediatorObserver"></span></figcaption>
</figure>
</section>
<section id="funzionamento-1" data-number="5.2.3">
<h3 data-number="5.2.3"><span class="header-section-number">5.2.3</span> Funzionamento</h3>
<p>La presenza del <strong><code>Mediator</code></strong> gioca un ruolo fondamentale nel <strong>riuso</strong> del codice perché, come approfondito in <a href="#subsec:mediator_solution" data-reference-type="ref" data-reference="subsec:mediator_solution">5.2.2</a> permette di <strong>passare in maniera semplice</strong> dalla modalità single-player a quella multi-player e viceversa.</p>
<p>Il diagramma di <strong>sequenza</strong>, raffigurato in <a href="#fig:sequenceMediator" data-reference-type="ref" data-reference="fig:sequenceMediator">5.5</a> mostra le dinamiche delle <strong>interazioni</strong> che coinvolgono il <code>Mediator</code> nel caso in cui ci si trovi nella modalità di gioco <strong>multiplayer</strong> e che, di conseguenza, siano coinvolti <strong>Client</strong> e <strong>Server</strong>.</p>
<figure>
<embed src="plantuml/rendered/sequenceDiagrams/sequenceMediator.pdf" id="fig:sequenceMediator" /><figcaption>Diagramma di sequenza di un ciclo di comunicazione Client-Server.<span label="fig:sequenceMediator"></span></figcaption>
</figure>
<p>Partendo dal messaggio immediatamente successivo allo start della partita si avranno, in maniera <strong>iterativa</strong>, le seguenti interazioni:</p>
<ol class="incremental">
<li><p>Il <strong>Client</strong> avrà appena ricevuto il <strong>mondo di gioco</strong> e sarà in <strong>attesa dell’input</strong> generato dalla reazione del giocatore. Il <code>GameScreen</code> rileva il comando e <strong>pubblica</strong> il relativo evento verso il proprio <strong>Mediator</strong></p></li>
<li><p>Il <code>Mediator</code> del <strong>Client</strong> procede a <strong>propagare</strong> l’evento a tutti coloro che sono ad esso <strong>sottoscritti</strong>. Nel caso del Client, solo il <strong><code>ClientActor</code></strong>.</p></li>
<li><p>Il <code>ClientActor</code>, ricevuto l’evento, lo comunicherà al <code>ServerActor</code> che procederà con la <strong>pubblicazione</strong> sul proprio <code>Mediator</code></p></li>
<li><p>Il <code>Mediator</code> del <strong>Server</strong> propaga l’evento ricevuto a tutti gli interessati. L’unico ad essere sottoscritto, nel caso del Server è l’<code>Engine</code>.</p></li>
<li><p>Il <code>GameScreen</code> del <strong>Server</strong> cattura il <strong>comando</strong> del giocatore che ospita alla partita. Questo comando, come accadeva per il Client, viene inoltrato al <code>Mediator</code> di riferimento.</p></li>
<li><p>Il <code>Mediator</code> invia a questo punto il comando all’<code>Engine</code></p></li>
<li><p>L’<code>Engine</code>, a questo punto, potrà calcolare il <strong>nuovo mondo di gioco</strong>, basandosi sulle azioni dell’<strong>Intelligenza Artificiale</strong> e dei <strong>giocatori</strong>, e inviarlo al proprio <code>Mediator</code> di riferimento.</p></li>
<li><p>In conclusione il <code>Mediator</code> invia il messaggio al <code>GameScreen</code> di tutti i giocatori: al Server in maniera diretta e ai Client tramite il layer di comunicazione.</p></li>
</ol>
<section id="single-player-1" data-number="5.2.3.0.1">
<h5 data-number="5.2.3.0.1"><span class="header-section-number">5.2.3.0.1</span> Single-player</h5>
<p>Nella modalità single-player si mantengono le dinamiche principali, ma senza tenere conto del layer di comunicazione dato da <code>ClientActor</code> e <code>ServerActor</code> poiché in tale modalità non sono presenti. Le interazioni principali avverranno quindi tra <code>GameScreen</code>, <code>Mediator</code> e <code>Engine</code>, nelle stesse modalità riportate precedentemente.</p>
</section>
</section>
</section>
<section id="sec:view_design" data-number="5.3">
<h2 data-number="5.3"><span class="header-section-number">5.3</span> View</h2>
<p>L’<strong>interfaccia grafica</strong> rappresenta uno degli elementi di spicco per quanto riguarda l’<strong>aspetto visivo</strong> di un videogioco. Gli utenti finali, infatti, non saranno interessati tanto alla progettazione del gioco quanto al modo con cui esso si presenta.</p>
<p>Al fine di garantire un’<strong>aspetto gradevole</strong> al gioco si è deciso quindi di puntare verso un <strong>design modulare</strong> che permettesse di poter definire in modo chirurgico l’intera <strong>user experience</strong>.</p>
<section id="struttura-a-schermate" data-number="5.3.1">
<h3 data-number="5.3.1"><span class="header-section-number">5.3.1</span> Struttura a schermate</h3>
<p>Il sistema di presentazione è stato così scomposto in <strong>schermate multiple</strong> (<code>Screen</code>) delegando ad ognuna di esse un particolare aspetto dell’<strong>interazione con l’utente</strong>.</p>
<figure>
<embed src="drawio/viewFacade/viewFacade.pdf" id="fig:viewFacade" /><figcaption>Diagramma delle classi relativo all’implementazione del pattern façade.<span label="fig:viewFacade"></span></figcaption>
</figure>
<p>Come vediamo in <a href="#fig:viewFacade" data-reference-type="ref" data-reference="fig:viewFacade">5.6</a> sono presenti cinque schermate fondamentali:</p>
<ul class="incremental">
<li><p><span><strong>GameScreen:</strong></span> Costituisce il cuore dell’interazione con <strong>ECS</strong> ed è il luogo in cui prende vita il vero e proprio <strong>gameplay</strong>. Come già anticipato in <a href="#sec:mediator_design" data-reference-type="ref" data-reference="sec:mediator_design">5.2</a>, questa schermata avrà la capacità di collegarsi in modo lasco con il <code>Mediator</code> e agirà da <strong>Input/Output</strong> di <strong>eventi</strong> (<code>SendCommand</code> <code>DrawEntities</code>).</p></li>
<li><p><span><strong>SelectLevelScreen:</strong></span> Rappresenta una delle poche <strong>schermate innestate dinamicamente</strong> nell’esperienza di gioco e il suo scopo consiste essenzialmente nella <strong>scelta</strong> dei vari <strong>livelli disponibili</strong>.</p></li>
<li><p><span><strong>MultiplayerScreen:</strong></span> È qui dove la logica del multiplayer prende vita. L’utente che vorrà giocare con questa modalità non dovrà fare altro che portarsi in questa schermata e selezionare la <strong>modalità di gioco</strong><br />
(<code>client/server-mode</code>) da utilizzare.</p></li>
<li><p><span><strong>StatScreen:</strong></span> È una semplice schermata relativa alle statistiche di gioco. Come in ogni <strong>arcade</strong> che si rispetti, questa mostrerà una lista dei <strong>migliori punteggi</strong> correlati al giocatore corrispondente.</p></li>
<li><p><span><strong>SettingsScreen:</strong></span> Ogni gioco necessita di una serie di impostazioni al fine di garantire una <strong>buona usabilità</strong> e <strong>personalizzazione</strong>. Questo aspetto sarà presente e sarà posizionato in una schermata dedicata.</p></li>
</ul>
<section id="screencontroller" data-number="5.3.1.0.1">
<h5 data-number="5.3.1.0.1"><span class="header-section-number">5.3.1.0.1</span> ScreenController:</h5>
<p>Un dettaglio che potrebbe far storcere il naso risiede nel fatto che ogni schermata <strong>estende</strong> da un’unica classe <code>ScreenController</code>. Que-sto dettaglio dipende fortemente dalla tecnologia utilizzata in fase di implementazione, <code>JavaFx</code>. In <code>JavaFx</code>, infatti, ad ogni layer di presentazione (<code>fxml</code>) è associato un <strong>modulo di controllo</strong> chiamato, appunto, <code>ScreenController</code>. Ogni <code>ScreenController</code> deve possedere la capacità di interfacciarsi con il<br />
<code>Controller</code> e come vedremo dovrà allo stesso modo poter <strong>interagire</strong> con le altre <strong>schermate</strong>.</p>
</section>
</section>
<section id="il-pattern-façade" data-number="5.3.2">
<h3 data-number="5.3.2"><span class="header-section-number">5.3.2</span> Il pattern Façade</h3>
<p>Il <strong>pattern Façade</strong> si configura come una soluzione davvero interessante al <strong>problema di interazione</strong> tra schermate introdotto precedentemente. Un <strong>façade</strong> (facciata) consiste in un oggetto che permette, attraverso un’<strong>interfaccia più semplice</strong>, l’<strong>accesso a sottosistemi</strong> che espongono <strong>interfacce complesse</strong> e <strong>molto diverse tra loro</strong>.</p>
<p>Nella situazione mostrata precedentemente, il façade (<code>ViewFacade</code>) permette di poter <strong>gestire l’interazione</strong> con ogni sotto-schermata da <strong>qualsiasi schermata</strong> mostrata in un certo istante all’utente. Questo permette alle sotto-schermate di poter essere <strong>sostituite</strong> in un unico modo garantendo così il <strong>Single Responsability Principle</strong>. Il pattern inoltre permette di elevare un insieme di <strong>metodi comuni</strong> all’interno di un’<strong>unica interfaccia</strong> permettendo così di rispettare il principio <strong>DRY</strong>.</p>
<section id="façade-e-mvc" data-number="5.3.2.0.1">
<h5 data-number="5.3.2.0.1"><span class="header-section-number">5.3.2.0.1</span> Façade e MVC:</h5>
<p>L’oggetto façade proposto (<code>ViewFacade</code>) implementa interamente il contratto definito per l’interfaccia grafica (<code>View</code>); di conseguenza esso rappresenta a tutti gli effetti il modulo di <strong>View</strong> all’interno del pattern architetturale <code>MVC</code>.</p>
</section>
<section id="façade-e-gestione-delle-schermate" data-number="5.3.2.0.2">
<h5 data-number="5.3.2.0.2"><span class="header-section-number">5.3.2.0.2</span> Façade e gestione delle schermate:</h5>
<p>Poiché il <code>ViewFacade</code> rappresenta un <strong>accesso</strong> disponibile <strong>a tutte le sotto-schermate</strong>, esso deve poter accedere a tutta la <strong>logica</strong> relativa alle stesse. Per garantire maggiori performance di caricamento si è deciso di costruire un <strong>modulo</strong> dedicato al <strong>loading</strong> e al <strong>caching</strong> delle <strong>schermate</strong>: lo <code>ScreenLoader</code>.</p>
<p>Il funzionamento è molto semplice: quando viene richiesta una schermata essa viene <strong>cercata nella cache</strong>, nel caso in cui non sia presente allora verrà <strong>caricata</strong> e successivamente <strong>mostrata all’utente</strong>. È importante che la <strong>cache</strong> di alcune schermate particolari (<code>GameScreen</code>) venga <strong>invalidata</strong> al fine di garantire una <strong>dinamicità del contenuto</strong>.</p>
</section>
</section>
</section>
<section id="sec:file_manager_design" data-number="5.4">
<h2 data-number="5.4"><span class="header-section-number">5.4</span> File Manager</h2>
<p>A seguito di un analisi dei file utilizzati e delle varie risorse caricate da jar e non, sono state individuate tre principali <strong>categorie</strong> di operazioni.</p>
<p>Operazioni su:</p>
<ol class="incremental">
<li><p><strong>File generici</strong></p></li>
<li><p><strong>File Yaml</strong></p></li>
<li><p><strong>Altri dati (musica, sprite, ecc)</strong></p></li>
</ol>
<p>Ogni categoria è gestita con una classe separata: i file generici sono stati gestiti dal <strong>FileManager</strong>, i file Yaml con lo <strong>YamlManager</strong> e gli altri dati con il <strong>DataManager</strong>.</p>
<figure>
<embed src="drawio/fileManager/fileManager.pdf" id="fig:FileManager" /><figcaption>Diagramma di classe rappresentante la struttura dei tre manager.<span label="fig:FileManager"></span></figcaption>
</figure>
<ul class="incremental">
<li><p><strong>FileManager</strong>: le operazioni di <strong>base</strong> sui file come il <strong>caricamento</strong> di una risorsa da jar o da sistema, possono essere effettuate da qualunque modulo dell’applicazione.</p>
<p>Un solo FileManager è sufficiente per la gestione dei file in tutto l’ applicativo; di conseguenza è stato progettato avvalendosi dell’utilizzo del pattern <strong>Singleton</strong>. Inoltre la divisione dei compiti e l’accesso globale consentono di diminuire il rischio di creare <strong>God class</strong>.</p></li>
<li><p><strong>YamlManager</strong>: i file <strong>Yaml</strong> sono la principale tecnica di <strong>serializzazione</strong> dei dati utilizzata nel contesto di questo progetto; in essi vengono salvati <strong>livelli</strong>, <strong>record</strong> e <strong>dati utente</strong>. Per questo è stato introdotto un <strong>gestore</strong> unicamente dedicato ai file Yaml che si appoggia sul <code>FileManager</code> per le <strong>operazioni di base</strong> e ne consente <strong>scrittura</strong> e <strong>lettura</strong>.</p></li>
<li><p><strong>DataManager</strong>: consente l’accesso a tutti i dati <strong>astratti</strong> del programma (livelli, impostazioni, statistiche, ecc). Si basa sullo <code>YamlManager</code> e il <code>FileManager</code> per effettuare le operazioni di caricamento e salvataggio ed è utilizzato dal <strong>Controller</strong> che lo sfrutta per accedere alle varie risorse <strong>testuali</strong>.</p></li>
</ul>
</section>
<section id="sec:audio_manager_design" data-number="5.5">
<h2 data-number="5.5"><span class="header-section-number">5.5</span> Audio Manager</h2>
<p>I videogiochi richiedono in generale il lancio di un elevato numero di <strong>suoni</strong> per partita. Questi suoni rientrano generalmente in una delle seguenti categorie:</p>
<ul class="incremental">
<li><p><strong>Effetti sonori:</strong> sono generalmente legati a <strong>eventi</strong> o a <strong>interazioni</strong> con la <strong>GUI</strong> del gioco.</p></li>
<li><p><strong>Musica:</strong> ricoprono un ruolo di <strong>sottofondo</strong> e vengono riprodotto con <strong>minor frequenza</strong>.</p></li>
</ul>
<section id="un-modello-ad-agenti" data-number="5.5.0.0.1">
<h5 data-number="5.5.0.0.1"><span class="header-section-number">5.5.0.0.1</span> Un modello ad agenti:</h5>
<p>L’elevata frequenza di eventi ha portato allo sviluppo di un <strong>Agente</strong> al quale è stato affidato il compito di <strong>gestire</strong> e <strong>manipolare</strong> internamente tutti gli aspetti sonori del gioco.</p>
<p>Il <code>SoundAgent</code> è caratterizzato da un <strong>flusso di controllo separato</strong> e utilizza una <strong>coda di eventi</strong> per tracciare tutte le <strong>azioni</strong> che deve effettuare. Gli utilizzatori possono infatti <strong>accodare eventi</strong> esternamente <strong>senza</strong> così <strong>inquinare</strong> l’operatività del <strong>proprio flusso</strong> di controllo. Un flusso di controllo separato consente di <strong>disaccoppiare</strong> al massimo il carico di lavoro, permettendo così di non gravare sulla logica principale del programma né tantomeno sulla <strong>View</strong>.</p>
<figure>
<embed src="drawio/audioAgent/audioAgent.pdf" id="fig:AudioAgent" /><figcaption>Diagramma di classe rappresentante la struttura del SoundAgent.<span label="fig:AudioAgent"></span></figcaption>
</figure>
<p>Un solo <code>SoundAgent</code> è in grado di riprodurre una grossa <strong>quantità di clip</strong>, ciò nonostante è possibile istanziarne più di uno, questo per non limitare il numero di suoni. È inoltre possibile creare <code>SoundAgent</code> specifici.</p>
<p>Un eventuale utilizzatore potrà quindi schedulare un nuovo evento semplicemente sfruttando il pattern <strong>Strategy</strong> implementando l’interfaccia funzionale <code>SoundAgentLogic</code>. Questo consente di evitare l’utilizzo reiterato di <strong>match case</strong> all’interno dell’agente, rendendo l’esecuzione più <strong>performante</strong> e il <strong>codice più snello</strong>.</p>
</section>
</section>
<section id="sec:client_server_design" data-number="5.6">
<h2 data-number="5.6"><span class="header-section-number">5.6</span> Client Server</h2>
<p>La realizzazione della modalità di gioco <strong>multiplayer</strong> richiede di elaborare una struttura che permetta a due o più giocatori di interagire <strong>contemporaneamente</strong> con la medesima partita.</p>
<p>Come introdotto in <a href="#subsec:client_server" data-reference-type="ref" data-reference="subsec:client_server">4.2.3</a> si è scelto di realizzare un sistema multi-giocatore con le seguenti caratteristiche:</p>
<ul class="incremental">
<li><p>I giocatori interagiscono con il gioco da <strong>istanze separate</strong>.</p></li>
<li><p>La gestione del sistema è <strong>centralizzata</strong> e la partita è gestita da un <strong>Server</strong>.</p></li>
</ul>
<figure>
<embed src="drawio/client-server/Controller-Actors-Interaction.pdf" id="fig:Controller-Actors-Interaction" /><figcaption>Diagramma delle classi che rappresenta le connessioni tra il Controller e gli attori Client e Server.<span label="fig:Controller-Actors-Interaction"></span></figcaption>
</figure>
<p>Per gestire l’<strong>interazione</strong> tra il Server e i Client era necessario disporre di un <strong>canale di comunicazione</strong> tra di essi. Per concretizzare ciò si è scelto di utilizzare un approccio ad <strong>attori</strong>, introducendo <code>ClientActor</code> e <code>ServerActor</code>. La <strong>modellazione</strong> dell’architettura <strong>Client-Server</strong> è stata realizzata come raffigurato in <a href="#fig:Controller-Actors-Interaction" data-reference-type="ref" data-reference="fig:Controller-Actors-Interaction">5.9</a>.</p>
<p>La struttura del diagramma si presenta con due elementi principali: gli <strong>attori</strong> e il <strong>Controller</strong>.</p>
<ul class="incremental">
<li><p><strong>Controller:</strong> rappresenta il punto di <strong>snodo</strong> dello schema ed espone, tra le altre cose, i metodi necessari per gestire le informazioni che arrivano dal <code>ClientActor</code> o dal <code>ServerActor</code>, a seconda della modalità in cui si vuole giocare.</p></li>
<li><p><strong>Attori:</strong> <code>ClientActor</code> e <code>ServerActor</code> sono intesi come <strong>interfaccia di comunicazione</strong> tra il sistema presente nell’istanza di gioco che agisce come <strong>Server</strong> e quello presente nelle istanze in funzione sui <strong>Client</strong>. I due attori comunicano mediante <strong>scambio di messaggi</strong>.</p></li>
</ul>
<section id="assetto-client-server" data-number="5.6.1">
<h3 data-number="5.6.1"><span class="header-section-number">5.6.1</span> Assetto Client-Server</h3>
<p>Il diagramma delle classi è stato progettato promuovendo un’idea di <strong>flessibi-lità</strong>. A seconda della modalità di gioco scelta, l’assetto deve poter <strong>variare</strong> per permettere una gestione <strong>efficiente</strong> delle dinamiche del sistema.</p>
<section id="modalità-client" data-number="5.6.1.1">
<h4 data-number="5.6.1.1"><span class="header-section-number">5.6.1.1</span> Modalità Client</h4>
<p>Nella modalità Client la struttura delle classi è la seguente:</p>
<ul class="incremental">
<li><p>L’<code>Engine</code> del gioco <strong>non viene utilizzato</strong> e pertanto risulta slegato dal Controller.</p></li>
<li><p>Il Controller <strong>crea</strong> e <strong>mantiene</strong> un’istanza del <code>ClientActor</code>.</p></li>
<li><p>Il <code>ServerActor</code> è <strong>assente</strong>.</p></li>
</ul>
</section>
<section id="modalità-server" data-number="5.6.1.2">
<h4 data-number="5.6.1.2"><span class="header-section-number">5.6.1.2</span> Modalità Server</h4>
<p>Quando il sistema passa in modalità Server, viene assunto un assetto diverso che si presenta in questo modo:</p>
<ul class="incremental">
<li><p>Il Controller <strong>crea</strong> e <strong>mantiene</strong> un’istanza del <code>ServerActor</code>.</p></li>
<li><p>Il <code>ClientActor</code> è <strong>assente</strong>.</p></li>
<li><p>L’<code>Engine</code> del gioco viene <strong>mantenuto</strong>, poiché dovrà occuparsi completamente della gestione della partita in corso.</p></li>
</ul>
</section>
</section>
<section id="gestione-della-comunicazione" data-number="5.6.2">
<h3 data-number="5.6.2"><span class="header-section-number">5.6.2</span> Gestione della comunicazione</h3>
<p>Ottenuta la configurazione relativa al <strong>ruolo</strong> scelto è possibile gestire i <strong>flussi</strong> di comunicazione che vanno dal <strong>Client</strong> al <strong>Server</strong> e viceversa.</p>
<section id="gestione-in-entrata" data-number="5.6.2.0.1">
<h5 data-number="5.6.2.0.1"><span class="header-section-number">5.6.2.0.1</span> Gestione in entrata:</h5>
<p>ciascun <strong>attore</strong>, nel momento in cui <strong>riceve</strong> un messaggio dalla sua controparte esterna, chiama, sul <strong>Controller</strong>, il <strong>metodo</strong> preposto alla gestione dello stesso.</p>
<p>Ad esempio, alla ricezione di un messaggio che indica l’inizio del gioco, il <code>ClientActor</code> dovrà chiamare il metodo <code>notifyGameStart()</code> sull’istanza di <code>ActorController</code> da esso <strong>mantenuta internamente</strong>.</p>
</section>
<section id="gestione-in-uscita" data-number="5.6.2.0.2">
<h5 data-number="5.6.2.0.2"><span class="header-section-number">5.6.2.0.2</span> Gestione in uscita:</h5>
<p>nel momento in cui, invece, è il sistema locale a dover <strong>aggiornare</strong> la controparte esterna su qualcosa, il flusso si inverte: il <strong>Controller</strong>, a fronte di un <strong>evento</strong>, chiama sull’attore il <strong>metodo</strong> preposto alla gestione dello stesso.</p>
<p>Ad esempio, alla pressione di un tasto da parte dell’utente, il Controller chiamerà il metodo <code>handle()</code> esposto dalla sua istanza di <code>ClientActor</code>, passando come parametro un <code>CommandEvent</code>. All’interno di questo metodo verrà eseguita una <code>send</code> che permetterà di inviare un messaggio al Server esterno al fine di notificare la ricezione del comando.</p>
</section>
</section>
<section id="sequenze-di-interazioni" data-number="5.6.3">
<h3 data-number="5.6.3"><span class="header-section-number">5.6.3</span> Sequenze di interazioni</h3>
<p>La gestione dell’<strong>inizio</strong>, dello <strong>svolgimento</strong> e dell’<strong>arresto</strong> di una partita <strong>multiplayer</strong> si svolge attraverso una serie di <strong>fasi</strong> di interazione tra gli elementi in gioco. Queste interazioni sono state evidenziate nel diagramma in <a href="#fig:sequenceClientServer" data-reference-type="ref" data-reference="fig:sequenceClientServer">5.10</a></p>
<p>Le fasi di interazione possono essere raggruppate in tre <strong>macro-fasi</strong>:</p>
<ol class="incremental">
<li><p><strong>Setup:</strong> prima di cominciare una partita è necessaria una prima fase di <strong>configurazione</strong> che si svolge nel seguente modo:</p>
<ol class="incremental">
<li><p>Inizialmente si ha che un’istanza del gioco assume il ruolo di <strong>Server</strong>, mentre una o più altre istanze scelgono il ruolo di <strong>Client</strong></p></li>
<li><p>Prima di iniziare il gioco, il giocatore che si trova sull’istanza Server sceglie il <strong>numero di giocatori</strong> e configura le <strong>impostazioni della partita</strong>.</p></li>
<li><p>Il Server rimane in <strong>attesa delle richieste di join</strong> provenienti dai Client.</p></li>
<li><p>Ad ogni richiesta di <code>join</code> ricevuta, il Server <strong>controlla</strong> se è stato raggiunto il <strong>numero massimo di giocatori</strong>. In caso affermativo <strong>respinge</strong> la richiesta, altrimenti la <strong>accoglie</strong>.</p></li>
<li><p>Quando vi è un <strong>numero corretto</strong> di Client collegati e quando questi si trovano tutti nello stato <code>ready</code>, il Server può <strong>avviare</strong> la partita.</p></li>
</ol></li>
<li><p><strong>Gioco:</strong> è la fase principale dove avvengono interamente le dinamiche di gioco e consiste nella ripetizione ciclica di tre step.</p>
<ol class="incremental">
<li><p>Ciascun Client invia al Server la propria azione, derivante dal <strong>comando</strong> impartito dal proprio utente.</p></li>
<li><p>Il Server <strong>riceve</strong> i comandi e li <strong>elabora</strong> insieme ai propri.</p></li>
<li><p>Il Server calcola il <strong>nuovo mondo</strong> e lo invia a tutti i Client.</p></li>
</ol></li>
<li><p><strong>Arresto:</strong> quando la partita giunge al termine avvengono le seguenti interazioni:</p>
<ol class="incremental">
<li><p>Il Server calcola i <strong>punteggi</strong></p></li>
<li><p>Il Server <strong>invia l’esito</strong> della partita a tutti Client.</p></li>
<li><p>Le <strong>connessioni</strong> tra il Server e i Client vengono <strong>chiuse</strong></p></li>
</ol></li>
</ol>
<figure>
<embed src="plantuml/rendered/sequenceDiagrams/sequenceClientServer.pdf" id="fig:sequenceClientServer" /><figcaption>Diagramma di sequenza che rappresenta la fase di join alla partita e lo svolgimento di essa.<span label="fig:sequenceClientServer"></span></figcaption>
</figure>
</section>
</section>
<section id="sec:interactions_design" data-number="5.7">
<h2 data-number="5.7"><span class="header-section-number">5.7</span> Interazioni</h2>
<section id="interazione-tra-engine-ecs-e-controller" data-number="5.7.0.1">
<h4 data-number="5.7.0.1"><span class="header-section-number">5.7.0.1</span> Interazione tra Engine, ECS e controller</h4>
<p>Come spiegato in <a href="#sec:ecs_design" data-reference-type="ref" data-reference="sec:ecs_design">5.1</a>, i vari gestori di componenti che formano l’ECS sono coordinati tra di loro tramite un <code>Coordinator</code>. Esso fa da punto di contatto con l’<code>Engine</code>, che rappresenta il gestore della partita e contiene:</p>
<ul class="incremental">
<li><p><strong>Coordinator:</strong> è l’entry point per interagire con le entità fondamentali di ECS, esponendo il metodo <code>updateAllSystems</code>;</p></li>
<li><p><strong>GameLoop:</strong> modellato come un flusso di controllo separato, è l’effettivo motore del gioco. Ha una visione limitata dell’engine, <code>UpdateableEngine</code>, su cui richiama ciclicamente update, causando l’aggiornamento dei sistemi, mantenendo costanti e modificabili gli fps mostrati all’utente;</p></li>
<li><p><strong>Mediator:</strong> consente al gioco di far comunicare <strong>Engine</strong> e il GameScreen in modalità single-player, mentre al join di una partita multiplayer come client l’engine verrà staccato da parte del controller e il mediator comunicherà con l’attore client. Invece, durante l’hosting di una partita multiplayer il server si affianca al <code>GameScreen</code> e tramite il <code>Mediator</code> riceve gli eventi dall’<code>Engine</code> e li comunica ai client partecipanti alla partita.</p></li>
</ul>
<figure>
<embed src="drawio/ECS-engine-controller/ecs-engine-controller.pdf" id="fig:ecs-engine-controller" /><figcaption>Diagramma raffigurante ecs, engine e controller e le loro interazioni.<span label="fig:ecs-engine-controller"></span></figcaption>
</figure>
</section>
<section id="interazione-tra-controller-e-view" data-number="5.7.0.2">
<h4 data-number="5.7.0.2"><span class="header-section-number">5.7.0.2</span> Interazione tra Controller e View</h4>
<p>Per rendere possibile l’aggiornamento della View da parte del controller è stato utilizzato il pattern observer, fornendo al controller un oggetto che implementa il trait <strong>ObserverUI</strong>. Esso fornisce al controller la possibilità di per poter comandare la view in tre scenari principali:</p>
<ul class="incremental">
<li><p><strong>Aggiornamento impostazioni globali:</strong> quando l’utente cambia impostazioni globali, o quando vengono caricati i valori di default permette alla view di essere aggiornata con i valori correnti;</p></li>
<li><p><strong>Aggiornamento impostazioni multiplayer:</strong> è necessario poter mos-trare ogni nuovo status della lobby, sia quando si unisce un nuovo giocatore alla partita sia al cambiamento dello stato di "ready" di un giocatore. Inoltre aggiorna i client sui cambiamenti delle impostazioni globali della partita effettuati lato server, che vengono anche essi mostrati nella schermata della lobby;</p></li>
<li><p><strong>Notifica di avvio partita multiplayer:</strong> quando l’host della partita decide di avviarla è necessario far cambiare schermata ai client e fargli caricare il loro GameScreen;</p></li>
</ul>
<p>Invece, per garantire la possibilità alla view di comunicare al controller le operazioni necessarie al setup delle differenti modalità di gioco gli viene fornito il trait <strong>ObservableUI</strong> che permette le seguenti operazioni:</p>
<ul class="incremental">
<li><p><strong>attachUI, detachUI:</strong> quando viene fatto eseguire il gioco in modalità server "headless" è necessario staccare la view, mentre al setup è necessario attaccarla al resto del sistema;</p></li>
<li><p><strong>loadAllLevels, loadStats, saveStats:</strong> durante la modifica e il caricamento delle impostazioni e delle statistiche, consentono alla view di caricarle da file e modificarle;</p></li>
<li><p><strong>becomeHost, startMultiplayer, shutDownMultiplayer:</strong></p>
<p>permettono lo switch tra le varie modalità di gioco, e causano il setup o la distruzione dei vari componenti associati;</p></li>
<li><p><strong>tryJoinLobby, kickSomeone, leaveLobby:</strong> permettono l’interazione con la lobby in modalità multiplayer;</p></li>
<li><p><strong>start, startMultiplayer:</strong> in modalità singleplayer e in modalità multiplayer quando si è host, notificano al controller l’intenzione dell’utente di iniziare una partita;</p></li>
</ul>
<figure>
<embed src="drawio/view-controller-observer/view-controller-observer.pdf" id="fig:view-controller-observer" /><figcaption>Diagramma raffigurante view, controller e observer e le loro interazioni.<span label="fig:view-controller-observer"></span></figcaption>
</figure>
</section>
</section>
</section>
<section id="implementazione" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Implementazione</h1>
<section id="luca-giulianini" data-number="6.1">
<h2 data-number="6.1"><span class="header-section-number">6.1</span> Luca Giulianini</h2>
<p>Lo studente Luca Giulianini si è occupato della <strong>progettazione</strong> e <strong>implementazione</strong> delle seguenti macro-parti:</p>
<ul class="incremental">
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>
<p>ha contribuito alla <strong>progettazione</strong> di:</p>
<ul class="incremental">
<li></li>
</ul>
<p>inoltre ha contribuito al lavoro dei colleghi svolgendo una serie di <strong>task implementativi</strong>:</p>
<ul class="incremental">
<li></li>
<li></li>
<li></li>
</ul>
<section id="approfondimenti" data-number="6.1.0.1">
<h4 data-number="6.1.0.1"><span class="header-section-number">6.1.0.1</span> Approfondimenti</h4>
<p>Parallelamente all’esperienza di progetto sono stati approfonditi una serie di argomenti relativi al mondo di <strong>Scala</strong> e della <strong>programmazione funzionale</strong>.</p>
<ul class="incremental">
<li><p><span><strong>Teoria delle Categorie:</strong></span> sono stati chiarite le principali astrazioni funzionali provenienti dalla teoria delle categorie. La libreria <code>cats</code> in questo senso fornisce ottime astrazioni per il concetto di <code>Semigroup, Monoid, Functor, Monad</code> (vedi <a href="#subsubsec:risorse" data-reference-type="ref" data-reference="subsubsec:risorse">6.1.8</a>).</p></li>
<li><p><span><strong>Pogrammazione funzionale:</strong></span> sono stati approfonditi gli aspetti teorici (<strong>referential transparency, effects, ecc</strong>) ed è stato appreso un insieme di <strong>buone pratiche</strong> relative alla programmazione funzionale. Questo è stato fatto seguento svariate <strong>conferenze</strong> dedicate al mondo Scala e appoggiandosi a una serie di <strong>libri</strong> dedicati.</p></li>
<li><p><span><strong>Refined Types:</strong></span> Molto utili nella fase di <strong>validazione statica e dinamica</strong> di input. Attualmente non utilizzati data la natura del progetto in questione.</p></li>
<li><p><span><strong>Monix:</strong></span> È stato approfondito il mondo della programmazione <strong>reattiva</strong> focalizzandosi maggiormente sul framework <code>Monix</code>.</p></li>
</ul>
</section>
<section id="subsec:arc_mediator" data-number="6.1.1">
<h3 data-number="6.1.1"><span class="header-section-number">6.1.1</span> Architettura generale e mediazione MVC-ECS</h3>
<section id="progettazione" data-number="6.1.1.1">
<h4 data-number="6.1.1.1"><span class="header-section-number">6.1.1.1</span> Progettazione</h4>
<p>La definizione di una architettura generale ha richiesto un grande sforzo dal punto di vista del <strong>design</strong>. I principali problemi da risolvere sono stati essenzialmente i seguenti:</p>
<ul class="incremental">
<li><p><span><strong>Interazione MVC-ECS:</strong></span> il problema in questo caso risiede nella <strong>natura architetturale</strong> dei due <strong>pattern</strong>. Essi generalmente sono utilizzati <strong>singolarmente</strong> per plasmare una applicazione e una possibile <strong>integrazione</strong> con altri pattern avrebbe potuto portare a <strong>seri conflitti</strong>.</p></li>
<li><p><span><strong>Estendibilità al modello client-server:</strong></span> l’idea architetturale fondante, per quanto riguarda l’intero applicativo, è sempre stata diretta verso la definizione di un <strong>core funzionante</strong> espandibile attraverso <strong>moduli client-server</strong> (attori). L’idea è stata sicuramente ambiziosa ma ha portato con se una serie di problemantiche non banali a livello interazionale. Infatti, sviluppare un <strong>core</strong> <strong>modulare</strong> e <strong>dinamico</strong> in base alla tipologia di interazione richiede un alto tasso di ingegnerizzazione e <strong>anticipazione del cambiamento</strong>.</p></li>
</ul>
<section id="la-soluzione" data-number="6.1.1.1.1">
<h5 data-number="6.1.1.1.1"><span class="header-section-number">6.1.1.1.1</span> La Soluzione</h5>
<p>La soluzione come già anticipato in <a href="#sec:mediator_design" data-reference-type="ref" data-reference="sec:mediator_design">5.2</a> è consistita nella defini-zione di un oggetto di tipo <code>publish/subscribe</code> (il <code>Mediator</code>) capace di <strong>mediare i flussi di dati</strong> fra un numero di oggetti indefinito.</p>
</section>
</section>
<section id="implementazione-1" data-number="6.1.1.2">
<h4 data-number="6.1.1.2"><span class="header-section-number">6.1.1.2</span> Implementazione</h4>
<section id="subsubsec:mediator_handler_problem" data-number="6.1.1.2.1">
<h5 data-number="6.1.1.2.1"><span class="header-section-number">6.1.1.2.1</span> Approccio ad Handlers</h5>
<p>L’implementazione del <code>Mediator</code> è stata inizialmente incentrata su una architettura basata su <strong>handlers</strong> ad <strong>eventi</strong> (vedi <a href="#fig:mediatorHandler" data-reference-type="ref" data-reference="fig:mediatorHandler">5.3</a>). L’architettura però ha da subito presentato alcune <strong>lacune</strong> molto gravi fra le quali troviamo l’impossibilità di poter <strong>rimuovere facilmente handlers relativi a un subscriber</strong> e una <strong>più difficile gestione delle gerarchie di eventi</strong>. Per questo motivo si è deciso di sacrificare un briciolo di performance e puntare maggiormente su una architettura più <strong>pulita</strong> e <strong>stabile</strong> basata su <strong>Observers</strong>.</p>
</section>
<section id="approccio-ad-observers" data-number="6.1.1.2.2">
<h5 data-number="6.1.1.2.2"><span class="header-section-number">6.1.1.2.2</span> Approccio ad Observers</h5>
<p>Questo approccio si basa essenzialmente sul modello proposto dal <strong>Pattern Observer</strong>. Nel caso proposto però la parte<br />
<span> </span><code>Observable</code> è stata incapsulata all’interno di un unico elemento, il <code>Mediator</code>. Così facendo il <code>Mediator</code> si configura come <strong>unico punto di snodo</strong> capace di <strong>osservare</strong> e <strong>ridirigere</strong> gli eventi verso l’<code>Observer</code> <strong>appropriato</strong> (<strong>Subscriber</strong>). La ridirezione è svolta osservando il <strong>tipo dell’evento</strong> in <strong>entrata</strong> e il tipo dell’evento al quale un <code>Observer</code> <strong>è interessato</strong>. Ogni <code>Observer</code> è interessato a tutti gli eventi che sono <strong>covarianti</strong> rispetto al tipo di evento al quale si sono <strong>sottoscritti</strong> (vedi <a href="#lst:listato1" data-reference-type="ref" data-reference="lst:listato1">[lst:listato1]</a>)</p>
<div class="sourceCode" id="lst:listato1" data-caption="Mediator" label="lst:listato1"><pre class="sourceCode scala"><code class="sourceCode scala"></code></pre></div>
<p>Per quanto riguarda la definizione degli eventi, si è deciso di utilizzare un approccio basato su <code>Algebraic Data Type</code> grazie al quale è possibile definire una gerarchia di eventi (vedi <a href="#lst:listato2" data-reference-type="ref" data-reference="lst:listato2">[lst:listato2]</a>)</p>
<div class="sourceCode" id="lst:listato2" data-caption="Event" label="lst:listato2"><pre class="sourceCode scala"><code class="sourceCode scala"></code></pre></div>
</section>
</section>
<section id="contributi-e-validazioni" data-number="6.1.1.3">
<h4 data-number="6.1.1.3"><span class="header-section-number">6.1.1.3</span> Contributi e validazioni</h4>
<ul class="incremental">
<li><p><span><strong>Gyordan Caminati:</strong></span> l’implementazione del <code>Mediator</code> tramite l’utilizzo di <code>Observers</code> è stata <strong>validata</strong> da Gyordan Caminati. Inoltre Gyordan ha fornito un <strong>contributo</strong> molto importante nella <strong>risoluzione di un problema</strong> riscontrato durante l’utilizzo di <strong>reflections</strong> in Scala.</p></li>
</ul>
</section>
</section>
<section id="subsec:arc_ecs" data-number="6.1.2">
<h3 data-number="6.1.2"><span class="header-section-number">6.1.2</span> Architettura ECS</h3>
<section id="progettazione-1" data-number="6.1.2.1">
<h4 data-number="6.1.2.1"><span class="header-section-number">6.1.2.1</span> Progettazione</h4>
<p>La fase di progettazione relativa ad ECS è consistita in un <strong>processo di continuo raffinamento</strong>, iniziato prendendo spunto da alcuni <strong>articoli proposti in rete</strong> e concluso con una <strong>soluzione</strong> estremamente <strong>pulita</strong> e <strong>concisa</strong>.</p>
<section id="composition-over-inheritance" data-number="6.1.2.1.1">
<h5 data-number="6.1.2.1.1"><span class="header-section-number">6.1.2.1.1</span> Composition over Inheritance</h5>
<p>Personalmente la sfida più grande in questo caso è stata trovare un design che permettesse di ottenere una <strong>buona estendibilità</strong> mantenendo allo stesso tempo delle <strong>buone performance</strong>. Si è passati così alla definizione di un modello <strong>data-driven</strong>, molto vicino ad una <strong>visione funzionale</strong>. Come vediamo in <a href="#fig:ECS" data-reference-type="ref" data-reference="fig:ECS">5.1</a> si è deciso di spostare l’intera architettura verso un approccio basato su <strong>composizione</strong>, molto <strong>estendibile</strong> e <strong>manutenibile</strong>.</p>
</section>
<section id="managers" data-number="6.1.2.1.2">
<h5 data-number="6.1.2.1.2"><span class="header-section-number">6.1.2.1.2</span> Managers</h5>
<p>L’intera <strong>logica di gestione</strong> è stata spostata <strong>al di fuori</strong> delle entità in gioco, all’interno di moduli dedicati chiamati <code>Manager</code>. Ogni manager è caratterizzato da un <strong>insieme ridotto di operazioni</strong> dedicate a <strong>gestire</strong> e <strong>connettere</strong> al più due <strong>tipologie</strong> di oggetti. Per esempio un <code>ComponentManager</code> è in grado di gestire solamente <code>Component</code> e per farlo mette in relazione ad essi anche delle <code>Entity</code>.</p>
</section>
<section id="coordinator" data-number="6.1.2.1.3">
<h5 data-number="6.1.2.1.3"><span class="header-section-number">6.1.2.1.3</span> Coordinator</h5>
<p>Poichè la gestione di singoli <code>Manager</code> separatamente produrrebbe un <strong>design frammentato</strong> e difficilmente controllabile, è stato deciso di <strong>coordinare</strong> quest’ultimi grazie ad un unico modulo che prende il nome appunto di<br />
<code>Coordinator</code>.</p>
</section>
</section>
<section id="implementazione-2" data-number="6.1.2.2">
<h4 data-number="6.1.2.2"><span class="header-section-number">6.1.2.2</span> Implementazione</h4>
<p>L’implementazione dell’architettura di <code>ECS</code> è risultata estramente <strong>lineare</strong> e <strong>non si è discostata</strong> di molto da ciò che era stato <strong>progettato</strong>.</p>
</section>
<section id="contributi-e-validazioni-1" data-number="6.1.2.3">
<h4 data-number="6.1.2.3"><span class="header-section-number">6.1.2.3</span> Contributi e validazioni</h4>
<ul class="incremental">
<li><p><span><strong>Ruben Ceroni:</strong></span> l’implementazione dell’architettura di <code>ECS</code> è stata <strong>validata</strong> da Ruben Ceroni il quale ha <strong>incoraggiato</strong> verso lo sviluppo di una <strong>soluzione</strong> basata su <strong>managers</strong>.</p></li>
</ul>
</section>
</section>
<section id="subsec:arc_view" data-number="6.1.3">
<h3 data-number="6.1.3"><span class="header-section-number">6.1.3</span> Framework View</h3>
<p>Le interfacce grafiche sono generalmente formate da più schermate che rappresentano <strong>moduli di interazione</strong> utente-applicativo. Una delle sfide più grandi che si devono affrontare nel momento in cui si sviluppa un’interfaccia grafica è la definizione di un <strong>framework</strong> capace di gestire al meglio questi moduli.</p>
<section id="progettazione-2" data-number="6.1.3.1">
<h4 data-number="6.1.3.1"><span class="header-section-number">6.1.3.1</span> Progettazione</h4>
<section id="problemi" data-number="6.1.3.1.1">
<h5 data-number="6.1.3.1.1"><span class="header-section-number">6.1.3.1.1</span> Problemi</h5>
<p>Il framework proposto si pone come obiettivo la risoluzione di due problemi fondamentali:</p>
<ul class="incremental">
<li><p><span><strong>Gestione e cambio di schermate:</strong></span> come introdotto precedentemente, dovrà essere possibile gestire in modo <strong>dinamico</strong> le schermate garantendo proprietà di <strong>scalabilità</strong> nel <strong>numero</strong> delle stesse. Inoltre si dovrà definire un modo per garantire un <strong>controllo</strong> nel <strong>cambio di schermata</strong>.</p></li>
<li><p><span><strong>Interazione View-Controller:</strong></span> l’interazione fra <code>View</code> e <code>Controller</code><br />
deve essere definita in modo <strong>pulito</strong> ed <strong>efficace</strong>. Lo scopo sarà quello di evitare la generazione di <strong>God-Class</strong> costituite da una moltitudine di <strong>metodi</strong> dedicati alle singole schermate.</p></li>
</ul>
</section>
<section id="soluzioni" data-number="6.1.3.1.2">
<h5 data-number="6.1.3.1.2"><span class="header-section-number">6.1.3.1.2</span> Soluzioni</h5>
<p>La soluzione proposte sono le seguenti:</p>
<ul class="incremental">
<li><p><span><strong>Gestione e cambio di schermata:</strong></span> in questo caso la soluzione si basa sull’ uso di un pattern molto utilizzato nel contesto delle GUI, il <code>Pattern Façade</code>. Il façade garantisce una <strong>facciata di interazione</strong> a tutte le sotto-schermate espondendo ad esse alcuni <strong>comandi fondamentali</strong>. In questo modo ogni sotto-schermata può chiedere al façade di essere <strong>sostituita</strong> o può chiedere il <strong>caricamento</strong> di una ulteriore schermata.</p></li>
<li><p><span><strong>Interazione View-Controller:</strong></span> L’interazione fra <code>View</code> e <code>Controller</code> è spesso regolamentata all’interno di MVC tramite il <code>Pattern Observer</code> basato sul <strong>Interface Segregation Principle</strong>. Secondo questa forma di Observer, <code>View</code> e <code>Controller</code> possiedono <strong>reciprocamente una sotto-interfaccia</strong> e tramite essa possono invocare metodi in modo sicuro.</p>
<p>Un problema che emerge dall’utilizzo di questo pattern risiede nel fatto che una <strong>aggiunta</strong> continua di <strong>funzionalità</strong> a queste sotto-interfacce potrebbe portare nel tempo a un’<strong>esplosione</strong> della dimensione due moduli (God-Class).</p>
<p>Al fine di evitare ciò si è deciso di utilizzare una versione più scalabile del Pattern Observer basata su <strong>eventi</strong>.</p></li>
</ul>
</section>
</section>
<section id="implementazione-3" data-number="6.1.3.2">
<h4 data-number="6.1.3.2"><span class="header-section-number">6.1.3.2</span> Implementazione</h4>
<section id="gestione-delle-schermate" data-number="6.1.3.2.1">
<h5 data-number="6.1.3.2.1"><span class="header-section-number">6.1.3.2.1</span> Gestione delle schermate</h5>
<p>La gestione delle schermate è stata delegata ad un modulo a parte chiamato <code>ScreenLoader</code>. Questo modulo è molto semplice e consiste, come vediamo nello snippet <a href="#lst:listato3" data-reference-type="ref" data-reference="lst:listato3">[lst:listato3]</a>, nella definizione di una <strong>cache</strong> dedicata alla gestione delle schermate.</p>
<p><code>ScreenLoader</code> mette a disposizione una serie di funzionalità di <strong>caricamento di schermate</strong> e <strong>gestione dei controller</strong> relativi. Il modulo permette inoltre di poter <strong>applicare una schermata ad un nodo</strong> abilitando così il <strong>cambio di schermata</strong>.</p>
<div class="sourceCode" id="lst:listato3" data-caption="ScreenLoader" label="lst:listato3"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="lst:listato3-1"><a href="#lst:listato3-1"></a><span class="kw">private</span>[view] <span class="kw">trait</span> ScreenLoader {</span>
<span id="lst:listato3-2"><a href="#lst:listato3-2"></a>  <span class="kw">def</span> <span class="fu">getScreenController</span>(screen: FXMLScreens): ScreenController</span>
<span id="lst:listato3-3"><a href="#lst:listato3-3"></a>  <span class="kw">def</span> <span class="fu">applyScreen</span>(screen: FXMLScreens, root: Pane): Unit</span>
<span id="lst:listato3-4"><a href="#lst:listato3-4"></a>  <span class="kw">def</span> <span class="fu">loadFXMLNode</span>(screen: FXMLScreens, controller: ScreenController): Unit</span>
<span id="lst:listato3-5"><a href="#lst:listato3-5"></a>}</span>
<span id="lst:listato3-6"><a href="#lst:listato3-6"></a><span class="kw">private</span>[view] <span class="kw">object</span> ScreenLoader {</span>
<span id="lst:listato3-7"><a href="#lst:listato3-7"></a>  <span class="kw">class</span> ScreenLoaderImpl <span class="kw">extends</span> ScreenLoader {</span>
<span id="lst:listato3-8"><a href="#lst:listato3-8"></a>    <span class="kw">private</span> <span class="kw">var</span> cache: Map[FXMLScreens, (Node, ScreenController)] = Map()</span>
<span id="lst:listato3-9"><a href="#lst:listato3-9"></a>    ....</span>
<span id="lst:listato3-10"><a href="#lst:listato3-10"></a>}</span></code></pre></div>
</section>
<section id="logica-di-cambio-di-schermata" data-number="6.1.3.2.2">
<h5 data-number="6.1.3.2.2"><span class="header-section-number">6.1.3.2.2</span> Logica di cambio di schermata</h5>
<p>La <strong>logica</strong> del cambio di schermata deve essere <strong>separata</strong> dalle singole schermate in modo che esse <strong>non debbano proccuparsi</strong> di dove ridirigere l’utente.</p>
<p>Seguento il principio di <strong>Separation of Concept</strong> si è deciso di delegare il cambio di schermata a una <strong>Macchina a Stati Finiti</strong> (<code>FSM</code>). Così facendo è possibile definire in modo dichiarativo una serie di coppie (<code>Event</code> <code>-&gt;</code> <code>State</code>) che costituiscono le <code>transizioni</code> della nostra <code>FSM</code>. Ovviamente, dato il contesto, definiremo uno <code>State</code> come <code>Screen</code>: ossia ogni stato sarà caratterizzato dalla schermata che sta mostrando (vedi <a href="#lst:listato4" data-reference-type="ref" data-reference="lst:listato4">[lst:listato4]</a>).</p>
<div class="sourceCode" id="lst:listato4" data-caption="View e StateMachine" label="lst:listato4"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="lst:listato4-1"><a href="#lst:listato4-1"></a><span class="kw">private</span> <span class="kw">class</span> <span class="fu">ViewImpl</span>(controller: UpdatableUI) <span class="kw">extends</span> View <span class="kw">with</span> ViewFacade {</span>
<span id="lst:listato4-2"><a href="#lst:listato4-2"></a>  <span class="kw">private</span> <span class="kw">val</span> stateMachine = ViewStateMachine.<span class="fu">buildStateMachine</span>()</span>
<span id="lst:listato4-3"><a href="#lst:listato4-3"></a>  <span class="kw">private</span> <span class="kw">val</span> root = <span class="kw">new</span> <span class="fu">StackPane</span>()</span>
<span id="lst:listato4-4"><a href="#lst:listato4-4"></a>  <span class="kw">override</span> <span class="kw">def</span> <span class="fu">changeScreen</span>(event: ScreenEvent): Unit = screenLoader.<span class="fu">applyScreen</span>(stateMachine.<span class="fu">consume</span>(event), root)</span>
<span id="lst:listato4-5"><a href="#lst:listato4-5"></a>  ....</span>
<span id="lst:listato4-6"><a href="#lst:listato4-6"></a>}</span>
<span id="lst:listato4-7"><a href="#lst:listato4-7"></a></span>
<span id="lst:listato4-8"><a href="#lst:listato4-8"></a><span class="kw">private</span>[view] <span class="kw">object</span> ViewStateMachine {</span>
<span id="lst:listato4-9"><a href="#lst:listato4-9"></a>  <span class="kw">def</span> <span class="fu">buildStateMachine</span>(): StateMachine[FXMLScreens, ScreenEvent] = StateMachine</span>
<span id="lst:listato4-10"><a href="#lst:listato4-10"></a>    .<span class="fu">WithFunctionTransitions</span>[FXMLScreens, ScreenEvent]()</span>
<span id="lst:listato4-11"><a href="#lst:listato4-11"></a>    .<span class="fu">initialState</span>(FXMLScreens.<span class="fu">HOME</span>)</span>
<span id="lst:listato4-12"><a href="#lst:listato4-12"></a>    .<span class="fu">transition</span>({</span>
<span id="lst:listato4-13"><a href="#lst:listato4-13"></a>      <span class="kw">case</span> (HOME, GotoLevels) =&gt; LEVELS</span>
<span id="lst:listato4-14"><a href="#lst:listato4-14"></a>      <span class="kw">case</span> (HOME, GotoLobby) =&gt; LOBBY</span>
<span id="lst:listato4-15"><a href="#lst:listato4-15"></a>      ...</span>
<span id="lst:listato4-16"><a href="#lst:listato4-16"></a>    }).<span class="fu">build</span>()</span>
<span id="lst:listato4-17"><a href="#lst:listato4-17"></a>}</span></code></pre></div>
</section>
<section id="interazione-view-controller" data-number="6.1.3.2.3">
<h5 data-number="6.1.3.2.3"><span class="header-section-number">6.1.3.2.3</span> Interazione View-Controller</h5>
<p>L’interazione tra <code>View</code> e <code>Controller</code> è stata implementata, come abbiamo già anticipato, sfruttando i pattern Observer ba-sato su Eventi. Al fine limitare una possibile esplosione di eventi si è deciso di sfruttare una struttura ad <code>Algebraic Data Type</code> <strong>gerarchica</strong>.</p>
<p>Si è deciso di creare una <strong>famiglia di eventi</strong> per ogni schermata definendo un <strong>trait dedicato</strong>. Così facendo il façade si trova a gestire solamente <strong>un tipo di evento per schermata</strong> delegando la gestione dell’<strong>evento concreto</strong> (sotto-tipo) alla schermata corrispondente.Questo approccio basato su <strong>deleghe</strong>, permette di ottenere un’<strong>implementazione pulita</strong> ed <strong>estendibile</strong> (vedi <a href="#lst:listato5" data-reference-type="ref" data-reference="lst:listato5">[lst:listato5]</a>).</p>
<div class="sourceCode" id="lst:listato5" data-caption="Observer[Event]" label="lst:listato5"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="lst:listato5-1"><a href="#lst:listato5-1"></a><span class="kw">trait</span> ObserverUI {</span>
<span id="lst:listato5-2"><a href="#lst:listato5-2"></a>  <span class="kw">def</span> <span class="fu">notify</span>(ev: ViewEvent): Unit</span>
<span id="lst:listato5-3"><a href="#lst:listato5-3"></a>}</span>
<span id="lst:listato5-4"><a href="#lst:listato5-4"></a><span class="kw">trait</span> View <span class="kw">extends</span> ObserverUI</span>
<span id="lst:listato5-5"><a href="#lst:listato5-5"></a><span class="kw">override</span> <span class="kw">def</span> <span class="fu">notify</span>(ev: ViewEvent): Unit = ev <span class="kw">match</span> {</span>
<span id="lst:listato5-6"><a href="#lst:listato5-6"></a>  <span class="kw">case</span> event: ViewEvent.<span class="fu">HomeEvent</span> =&gt; screenLoader.<span class="fu">getScreenController</span>(FXMLScreens.<span class="fu">HOME</span>).<span class="fu">notify</span>(event)</span>
<span id="lst:listato5-7"><a href="#lst:listato5-7"></a>  <span class="kw">case</span> event: ViewEvent.<span class="fu">GameEvent</span> =&gt; screenLoader.<span class="fu">getScreenController</span>(FXMLScreens.<span class="fu">GAME</span>).<span class="fu">notify</span>(event)</span>
<span id="lst:listato5-8"><a href="#lst:listato5-8"></a>  <span class="kw">case</span> event: ViewEvent.<span class="fu">LobbyEvent</span> =&gt; screenLoader.<span class="fu">getScreenController</span>(FXMLScreens.<span class="fu">LOBBY</span>).<span class="fu">notify</span>(event)</span>
<span id="lst:listato5-9"><a href="#lst:listato5-9"></a>  ...</span>
<span id="lst:listato5-10"><a href="#lst:listato5-10"></a>}</span></code></pre></div>
</section>
</section>
<section id="contributi-e-validazioni-2" data-number="6.1.3.3">
<h4 data-number="6.1.3.3"><span class="header-section-number">6.1.3.3</span> Contributi e validazioni</h4>
<ul class="incremental">
<li><p><span><strong>Gyordan Caminati:</strong></span> l’implementazione del framework proposto è stata <strong>validata</strong> da Gyordan Caminati. Gyordan ha contribuito inoltre a fornire un <strong>input</strong> per un’idea di <strong>interazione ad eventi</strong>, sopra alla quale poi è stata sviluppata l’implementazione finale.</p></li>
</ul>
</section>
</section>
<section id="subsec:game_screen" data-number="6.1.4">
<h3 data-number="6.1.4"><span class="header-section-number">6.1.4</span> Schermata di Gioco</h3>
<p>Come introdotto precedentemente in <a href="#sec:mediator_design" data-reference-type="ref" data-reference="sec:mediator_design">5.2</a> lo scopo di <code>Mediator</code> consiste nel creare un collegamento <strong>lasco</strong> fra <code>GameScreen</code> e <code>Engine/ClientActor</code>. La schermata di gioco si configura quindi come punto di incontro fra pattern <code>ECS</code> e <code>MVC</code>; di conseguenza è molto importante saper suddividere le varie <strong>responsabilità</strong>. Come vediamo in <a href="#lst:listato6" data-reference-type="ref" data-reference="lst:listato6">[lst:listato6]</a> la separazione dei concetti è molto forte ed è dettata dall’implementazione di due interfacce separate:</p>
<ul class="incremental">
<li><p><span><code>Displayable:</code></span> gestisce gli eventi provenienti da <code>Mediator</code>. Ovviamente questi sono inoltrati solamente previa <strong>sottoscrizione</strong> al <code>Mediator</code> che è così in grado di associare alla schermata di gioco l’insieme di eventi compatibili (subtype di <code>Displayable</code>).</p></li>
<li><p><span><code>ScreenController:</code></span> abstract root class che fornisce un metodo <code>notify</code> che veicola tutti i messaggi che giungono al <code>View-Façade</code>. Ogni schermata implementa una gestione dedicata ai soli <strong>propri messaggi</strong>.</p></li>
</ul>
<p><code>GameScreen</code> dovrebbe idealmente rappresentare una schermata utile solo in <strong>fase di gioco</strong>, di conseguenza ci si auspica che la gestione di eventi provenienti da <code>Controller</code> sia ridotta al minimo.</p>
<div class="sourceCode" id="lst:listato6" data-caption="ScreenControllerGame" label="lst:listato6"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="lst:listato6-1"><a href="#lst:listato6-1"></a><span class="kw">class</span> <span class="fu">ScreenControllerGame</span>(viewFacade, controller) <span class="kw">extends</span> <span class="fu">AbstractScreenController</span>(viewFacade, controller) <span class="kw">with</span> Displayable {</span>
<span id="lst:listato6-2"><a href="#lst:listato6-2"></a>  <span class="kw">private</span> <span class="kw">val</span> mediator: Mediator = controller.<span class="fu">getMediator</span></span>
<span id="lst:listato6-3"><a href="#lst:listato6-3"></a>  mediator.<span class="fu">subscribe</span>(<span class="kw">this</span>)</span>
<span id="lst:listato6-4"><a href="#lst:listato6-4"></a>  <span class="co">//Events from mediator to Displayable (GameScreen)</span></span>
<span id="lst:listato6-5"><a href="#lst:listato6-5"></a>  <span class="kw">override</span> <span class="kw">def</span> <span class="fu">notifyDrawEntities</span>(player: EntityData, entities: Seq[EntityData]): Unit = <span class="fu">handleDrawEntities</span>(players, entities))</span>
<span id="lst:listato6-6"><a href="#lst:listato6-6"></a>  <span class="kw">override</span> <span class="kw">def</span> <span class="fu">notifyEntityLife</span>(data: LifeData): Unit = <span class="fu">handleEntityLife</span>(data)</span>
<span id="lst:listato6-7"><a href="#lst:listato6-7"></a>  <span class="kw">override</span> <span class="kw">def</span> <span class="fu">notifyLevelEnd</span>(data: LevelEndData): Unit = <span class="fu">handleLevelEnd</span>(data)</span>
<span id="lst:listato6-8"><a href="#lst:listato6-8"></a>  <span class="co">//Mvc events from Controller</span></span>
<span id="lst:listato6-9"><a href="#lst:listato6-9"></a>  <span class="kw">override</span> <span class="kw">def</span> <span class="fu">notify</span>(ev: ViewEvent): Unit = ev <span class="kw">match</span> {</span>
<span id="lst:listato6-10"><a href="#lst:listato6-10"></a>    <span class="kw">case</span> <span class="fu">LevelSetupEvent</span>(data) =&gt; <span class="fu">handleLevelSetup</span>(data)</span>
<span id="lst:listato6-11"><a href="#lst:listato6-11"></a>  }</span>
<span id="lst:listato6-12"><a href="#lst:listato6-12"></a>  <span class="kw">def</span> <span class="fu">sendCommandEvent</span>(event: Event.<span class="fu">CommandEvent</span>): Unit = mediator.<span class="fu">publishEvent</span>(event)</span></code></pre></div>
<section id="eventi-di-gioco" data-number="6.1.4.1">
<h4 data-number="6.1.4.1"><span class="header-section-number">6.1.4.1</span> Eventi di gioco</h4>
<p>La gestione del gamplay è modellata su questi eventi:</p>
<ul class="incremental">
<li><p><span><strong>LevelSetup:</strong></span> inviato nel momento in fase di caricamento di un livello: esso è responsabile della creazione e inizializzazione delle logiche di <strong>comando</strong> e <strong>visualizzazione</strong>.</p></li>
<li><p><span><strong>DrawEntities:</strong></span> evento di <strong>visualizzazione</strong> contenente le entità da <strong>disegnare</strong>.</p></li>
<li><p><span><strong>EntityLife:</strong></span> evento di <strong>gioco</strong> che contiene il <strong>danno inferto</strong> all’entità governata dall’utente.</p></li>
<li><p><span><strong>LevelEnd:</strong></span> evento utilizzato per <strong>dismettere</strong> le strutture dati create per gestire il gamplay.</p></li>
</ul>
</section>
<section id="implementazione-gameplay" data-number="6.1.4.2">
<h4 data-number="6.1.4.2"><span class="header-section-number">6.1.4.2</span> Implementazione gameplay</h4>
<p>La gestione del vero e proprio gameplay è stata nascosta in una classe astratta chiamata <code>AbstractScreenControllerGame</code>. La suddivisione è stata proposta per garantire una maggiore pulizia e definire una <strong>separazione</strong> fra interazione e operazioni interne che verranno appunto gestite da questa classe. La gestione del gameplay si focalizza su due operazioni fondamentali:</p>
<ul class="incremental">
<li><p><span><strong>Elaborazione e invio di comandi</strong></span></p></li>
<li><p><span><strong>Visualizzazione delle entità</strong></span></p></li>
</ul>
<section id="elaborazione-e-invio-di-comandi" data-number="6.1.4.2.1">
<h5 data-number="6.1.4.2.1"><span class="header-section-number">6.1.4.2.1</span> Elaborazione e invio di comandi</h5>
<p>L’elaborazione di comandi è un’opera-zione molto delicata poiché si basa sull’<strong>acquisizione</strong> real-time dell’input dell’u-tente. In questo frangente la libreria <code>JavaFx</code> si è rivelata molto utile poiché permette di ottenere, tramite <code>handlers</code>, un <strong>flusso continuo</strong> di eventi da <strong>qualsiasi nodo</strong> della schermata.</p>
<p>Dato che l’acquisizione non deve essere costante ma solo dedicata alla <strong>fase di gioco</strong>, si è deciso di <strong>racchiudere</strong> la logica di gestione ed elaborazione dell’input in un <strong>modulo immutabile</strong>, <code>GameEventHandler</code> (vedi <a href="#lst:listato7" data-reference-type="ref" data-reference="lst:listato7">[lst:listato7]</a>).</p>
<div class="sourceCode" id="lst:listato7" data-caption="GameEventHandler" label="lst:listato7"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="lst:listato7-1"><a href="#lst:listato7-1"></a><span class="kw">case</span> <span class="kw">class</span> <span class="fu">GameEventHandler</span>(<span class="kw">val</span> pane: Pane, <span class="kw">val</span> handleCommand: CommandEvent =&gt; Unit, <span class="kw">val</span> entity: Entity) {</span>
<span id="lst:listato7-2"><a href="#lst:listato7-2"></a>	<span class="kw">private</span> <span class="kw">val</span> activeKeys = mutable.<span class="fu">HashSet</span>()</span>
<span id="lst:listato7-3"><a href="#lst:listato7-3"></a>	pane.<span class="fu">addEventHandler</span>(KeyEvent.<span class="fu">KEY_PRESSED</span>, keyPressedHandler)</span>
<span id="lst:listato7-4"><a href="#lst:listato7-4"></a>	<span class="kw">object</span> ImplicitConversions {</span>
<span id="lst:listato7-5"><a href="#lst:listato7-5"></a>    <span class="kw">implicit</span> <span class="kw">def</span> <span class="fu">keyToDir</span>(key: KeyCode): Direction = key <span class="kw">match</span> {</span>
<span id="lst:listato7-6"><a href="#lst:listato7-6"></a>      <span class="kw">case</span> W =&gt; North</span>
<span id="lst:listato7-7"><a href="#lst:listato7-7"></a>      <span class="kw">case</span> S =&gt; South</span>
<span id="lst:listato7-8"><a href="#lst:listato7-8"></a>      ...</span>
<span id="lst:listato7-9"><a href="#lst:listato7-9"></a>		}		</span>
<span id="lst:listato7-10"><a href="#lst:listato7-10"></a>	}</span>
<span id="lst:listato7-11"><a href="#lst:listato7-11"></a>  <span class="kw">private</span> <span class="kw">def</span> <span class="fu">createKeyPressHandler</span>(): EventHandler = e =&gt; {</span>
<span id="lst:listato7-12"><a href="#lst:listato7-12"></a>    <span class="kw">val</span> dir = e.<span class="fu">getCode</span></span>
<span id="lst:listato7-13"><a href="#lst:listato7-13"></a>    <span class="kw">if</span> (!activeKeys.<span class="fu">contains</span>(dir)) {</span>
<span id="lst:listato7-14"><a href="#lst:listato7-14"></a>      activeKeys add dir</span>
<span id="lst:listato7-15"><a href="#lst:listato7-15"></a>      <span class="fu">update</span>()</span>
<span id="lst:listato7-16"><a href="#lst:listato7-16"></a>    }</span>
<span id="lst:listato7-17"><a href="#lst:listato7-17"></a>  }</span>
<span id="lst:listato7-18"><a href="#lst:listato7-18"></a>  <span class="kw">private</span> <span class="kw">def</span> <span class="fu">createKeyReleasedHandler</span>(): EventHandler ....</span>
<span id="lst:listato7-19"><a href="#lst:listato7-19"></a>  <span class="kw">private</span> <span class="kw">def</span> <span class="fu">update</span>(): Unit = {</span>
<span id="lst:listato7-20"><a href="#lst:listato7-20"></a>    <span class="kw">val</span> dir = activeKeys.<span class="fu">foldLeft</span>[Direction](Center)(_ + _)</span>
<span id="lst:listato7-21"><a href="#lst:listato7-21"></a>    <span class="fu">handleCommand</span>(<span class="fu">CommandEvent</span>(<span class="fu">CommandData</span>(entity, dir)))</span>
<span id="lst:listato7-22"><a href="#lst:listato7-22"></a>  } </span>
<span id="lst:listato7-23"><a href="#lst:listato7-23"></a>}</span></code></pre></div>
<p>Il funzionamento del modulo è molto semplice: esso infatti rispecchia le fasi di <em>setup</em> (<code>LevelSetupEvent</code>) e <em>teardown</em> (<code>LevelEndEvent</code>) elencate precedentemente con una modalità operativa che questa volta è dedicata all’<em>invio di comandi</em> piuttosto che alla visualizzazione di entità.</p>
<ul class="incremental">
<li><p><span><strong>Setup:</strong></span> in fase di setup vengono <strong>inizializzati</strong> e <strong>agganciati</strong> gli handler utili per la generazione di eventi. Inoltre viene fornito l’<strong>uuid</strong> del player, utile per marcare i messaggi inviati.</p></li>
<li><p><span><strong>Teardown:</strong></span> una volta completato il gameplay potranno essere <strong>sganciati</strong> gli <strong>handler</strong>.</p></li>
</ul>
<section id="invio-di-commandevent" data-number="6.1.4.2.1.1">
<h6 data-number="6.1.4.2.1.1"><span class="header-section-number">6.1.4.2.1.1</span> Invio di CommandEvent</h6>
<p>La gestione dell’invio di comandi si svolge in questo modo: Quando l’utente preme un testo il sistema in tempo reale invoca l’handler dedicato il quale restituirà un evento contente il <strong>codice</strong> del pulsante premuto. Il codice, opportunamente convertito in <code>Direction</code> viene aggiunto a un set che mantiene le <strong>direzioni attualmente attive</strong> e dopo aver calcolato la <strong>direzione risultate</strong> essa viene inviata sotto forma di <code>CommandEvent</code> all’<code>Engine</code>.</p>
</section>
</section>
<section id="visualizzazione-delle-entità" data-number="6.1.4.2.2">
<h5 data-number="6.1.4.2.2"><span class="header-section-number">6.1.4.2.2</span> Visualizzazione delle entità</h5>
<p>Dato che la visualizzazione di entità è strettamente legata alla tipologia delle stesse si è deciso di racchiudere la logica di disegno all’interno di particolari oggetti chiamati <code>EntityWrapper</code>. Ogni wrapper possiede un’immagine specifica per ogni entità e contiene inoltre un metodo <code>draw</code> che ne definisce la visualizzazione.</p>
</section>
</section>
</section>
<section id="subsec:ci" data-number="6.1.5">
<h3 data-number="6.1.5"><span class="header-section-number">6.1.5</span> Continuous Integration e configurazione dei Build-Tools</h3>
<p>Data la buona esperienza accumulata nell’ambito della <code>CI</code> l’implementazione della stessa è stata svolta interamente dallo studente. In questo caso si è deciso di sperimentare un processo di <strong>rilascio</strong> basanto interamente su <code>GitHub</code>. Per fare ciò ci è affidati ai servizi <code>Releases</code> e <code>Pages</code> messi a disposizione dalla piattaforma. Un’altra sperimentazione ha portato a definire un processo di deploy dedicato ai file <code>.tex</code>, il quale permetteva di <strong>compilare remotamente</strong> la relazione per poi <strong>inviarla</strong> ai colleghi in modo automatico.</p>
</section>
<section id="subsec:media_event" data-number="6.1.6">
<h3 data-number="6.1.6"><span class="header-section-number">6.1.6</span> Sound Agent - design basato su Handlers</h3>
<section id="progettazione-3" data-number="6.1.6.1">
<h4 data-number="6.1.6.1"><span class="header-section-number">6.1.6.1</span> Progettazione</h4>
<p>Rifacendosi alla grande intuizione di Gyordan nel dotare il <code>SoundAgent</code> di un <strong>thread di elaborazione separato</strong>, si è colta l’opportunità di migliorare ancora di più il design aggiungendo una <strong>gestione ad eventi</strong>. È stato poi definito un tipo di evento standard, <code>MediaEvent</code> il quale fornisce un unico metodo <code>handle</code> che opera su un <code>SoundEventLogic</code> (vedi <a href="#lst:listato8" data-reference-type="ref" data-reference="lst:listato8">[lst:listato8]</a>).</p>
<div class="sourceCode" id="lst:listato8" data-caption="MediaEvent e Integrazione in SoundAgent" label="lst:listato8"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="lst:listato8-1"><a href="#lst:listato8-1"></a><span class="kw">private</span> <span class="kw">final</span> <span class="kw">class</span> ConcreteSoundAgent <span class="kw">extends</span> SoundAgendLogic {</span>
<span id="lst:listato8-2"><a href="#lst:listato8-2"></a>	<span class="kw">override</span> <span class="kw">def</span> <span class="fu">run</span>(): Unit = {</span>
<span id="lst:listato8-3"><a href="#lst:listato8-3"></a>		<span class="kw">while</span> (<span class="kw">true</span>) {</span>
<span id="lst:listato8-4"><a href="#lst:listato8-4"></a>  		<span class="fu">Try</span>(<span class="kw">this</span>.<span class="fu">blockingQueue</span>.<span class="fu">take</span>()) <span class="kw">match</span> {</span>
<span id="lst:listato8-5"><a href="#lst:listato8-5"></a>    		<span class="kw">case</span> <span class="fu">Success</span>(ev) =&gt; <span class="fu">processEvent</span>(ev)</span>
<span id="lst:listato8-6"><a href="#lst:listato8-6"></a>    		<span class="kw">case</span> <span class="fu">Failure</span>(exception) =&gt; logger <span class="fu">warn</span> (exception.<span class="fu">getMessage</span>)</span>
<span id="lst:listato8-7"><a href="#lst:listato8-7"></a>    	}</span>
<span id="lst:listato8-8"><a href="#lst:listato8-8"></a><span class="kw">def</span> <span class="fu">processEvent</span>(ev: MediaEvent): Unit = ev.<span class="fu">handle</span>(<span class="kw">this</span>)</span>
<span id="lst:listato8-9"><a href="#lst:listato8-9"></a>...</span>
<span id="lst:listato8-10"><a href="#lst:listato8-10"></a></span>
<span id="lst:listato8-11"><a href="#lst:listato8-11"></a><span class="kw">sealed</span> <span class="kw">trait</span> MediaEvent {</span>
<span id="lst:listato8-12"><a href="#lst:listato8-12"></a>  <span class="kw">def</span> <span class="fu">handle</span>(sl: SoundAgentLogic): Unit</span>
<span id="lst:listato8-13"><a href="#lst:listato8-13"></a>}</span>
<span id="lst:listato8-14"><a href="#lst:listato8-14"></a><span class="kw">object</span> MediaEvent {</span>
<span id="lst:listato8-15"><a href="#lst:listato8-15"></a><span class="kw">final</span> <span class="kw">case</span> <span class="kw">class</span> <span class="fu">PlayMusicEvent</span>(media: Music) <span class="kw">extends</span> MediaEvent {</span>
<span id="lst:listato8-16"><a href="#lst:listato8-16"></a>  <span class="kw">def</span> <span class="fu">handle</span>(sl: SoundAgentLogic): Unit = sl.<span class="fu">playMusic</span>(media)</span>
<span id="lst:listato8-17"><a href="#lst:listato8-17"></a>} ...</span></code></pre></div>
<p>Un <code>MediaEvent</code> si configura quindi come un <strong>handler</strong>, ossia un contenitore di codice che potrà essere eseguito su un qualsiasi oggetto che implementi <code>SoundAgentLogic</code>. L’integrazione di <code>MediaEvent</code> e <code>SoundAgent</code> ha portato alla definizione di un <strong>event loop</strong> capace di eseguire eventi che hanno come target lo stesso <code>SoundAgent</code>:</p>
<pre><code>case Success(ev) =&gt; ev.handle(this)</code></pre>
</section>
</section>
<section id="altri-task" data-number="6.1.7">
<h3 data-number="6.1.7"><span class="header-section-number">6.1.7</span> Altri Task</h3>
<section id="subsubsec:input_sys" data-number="6.1.7.1">
<h4 data-number="6.1.7.1"><span class="header-section-number">6.1.7.1</span> Input System</h4>
<p>L’<code>InputSystem</code> è il sistema dedicato all’elaborazione dell’input dell’utente il cui scopo principe è quello di fornire una <strong>direzione</strong> alle entità di gioco. In questo caso la soluzione ottima è stata ottenuta andando a <strong>completare</strong> quella proposta dal lato <code>View</code>.</p>
<p>I comandi precedentemente accodati vengono estratti dalla coda, <strong>filtrati</strong> in base all’<strong>entità corrispondente</strong> e infine mappati in <strong>direzioni</strong>. Poiché le direzioni contenute nei comandi seguono un <strong>ordine cronologico</strong>, sarà necessario mantenere solamente l’<strong>ultima direzione</strong> disponibile scartando tutte le altre.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</section>
<section id="subsubsec:damage" data-number="6.1.7.2">
<h4 data-number="6.1.7.2"><span class="header-section-number">6.1.7.2</span> Life points e collision damage</h4>
<p>Data la grande <strong>flessibilità</strong> di ECS è stato molto facile introdurre il concetto di <strong>danno a fronte di collisioni</strong>. L’implementazione consiste di due parametri all’interno del <code>CollisionComponent</code>: <strong>vita</strong> (<code>life</code>) e <strong>danno</strong> (<code>damage</code>). Nel momento in cui viene rilevata una <strong>collisione</strong> i <strong>life points</strong> dell’utente vengono <strong>decrementati</strong> in base al danno indicato sulla medesima entità.</p>
<p>L’implementazione è stata <strong>decisamente migliorata</strong> da <strong>Sara Kiade</strong> che ha aggiunto <strong>nuove dinamiche</strong> irrobustendo contemporaneamente quelle già proposte.</p>
<section id="interazione-con-view" data-number="6.1.7.2.1">
<h5 data-number="6.1.7.2.1"><span class="header-section-number">6.1.7.2.1</span> Interazione con View:</h5>
<p>Al fine di <strong>comunicare</strong> i vari punti vita alle varie <strong>interfacce grafiche</strong> è stato predisposto un <strong>messaggio di mediazione</strong> dedicato: <code>EntityLifeEvent</code>. Nel momento della ricezione del messaggio, lato view, è stata creata una <strong>barra di caricamento</strong> che viene mano a mano decrementata a seconda del <strong>danno inferto</strong>.</p>
</section>
</section>
<section id="subsubsec:monix_sys" data-number="6.1.7.3">
<h4 data-number="6.1.7.3"><span class="header-section-number">6.1.7.3</span> Monix - Parallelizzazione update dei sistemi</h4>
<p>Uno dei problemi di ECS risiede nella sua natura <strong>poco parallelizzabile</strong>. Al fine di mantenere la <strong>consistenza</strong> fra le varie entità, infatti, il framework richiede che l’<strong>aggiornamento di gioco</strong> venga svolto <strong>in maniera sequenziale</strong> invocando il metodo <code>update()</code> su ogni sistema. Relativamente all’implementazione del metodo <code>update()</code>, invece, non vi sono restrizioni particolari e ciò garantisce <strong>ampio margine per ottimizzazioni</strong>.</p>
<p>L’ottimizzazione proposta si basa sul reactive-framework <code>Monix</code> e consiste essenzialmente nel <strong>eseguire le operazioni sulle entità</strong> (collisioni) in modo <strong>parallelo</strong> splittando il Set in base al numero di core disponibili.</p>
</section>
</section>
<section id="subsubsec:risorse" data-number="6.1.8">
<h3 data-number="6.1.8"><span class="header-section-number">6.1.8</span> Risorse</h3>
<p>Gli approfondimenti sono stati svolti grazie all’utilizzo delle seguenti risorse:</p>
<ul class="incremental">
<li><p><span><strong>Libri:</strong></span></p>
<ul class="incremental">
<li><p><span><strong>Learning Scala <span class="citation" data-cites="scalaLearning:2014">(Swartz 2014)</span>:</strong></span> libro che riassume interamente le <strong>principali features</strong> del linguaggio Scala in ambito <strong>funzionale</strong>. È stato usato per consolidare alcune conoscenze pregresse.</p></li>
<li><p><span><strong>Programming in Scala <span class="citation" data-cites="scalaBook:2014">(M. Odersky 2016)</span>:</strong></span> rappresenta la bibbia di Scala ed è stato scritto dal grandissimo <strong>Martin Odersky</strong>.</p></li>
<li><p><span><strong>Scala with Cats <span class="citation" data-cites="scalaCats:2020">(Welsh and Gurnell 2020)</span>:</strong></span> libro che copre gli aspetti più <strong>avanzati</strong> del linguaggio Scala dal punto di vista <strong>funzionale</strong>. Per ogni singolo aspetto è fornita una <strong>definizione teorica</strong> e la relativa implementazione nella libreria ufficiale <a href="https://typelevel.org/cats-effect/"><code>Cats</code></a>. È un libro particolarmente <strong>complesso</strong> ed è stato utilizzato come approfondimento.</p></li>
<li><p><span><strong>Scala Cookbook <span class="citation" data-cites="scalaCook:2013">(Alexander 2013)</span>:</strong></span> I <strong>Cookbook</strong> di O’Reilly sono conosciuti per essere estremamente <strong>pragmatici</strong>. Anche in questo caso il libro si configura come un’<strong>enciclopedia del problem solving</strong> dedicata interamente al linguaggio Scala.</p></li>
<li><p><span><strong>Functional Programming in Scala <span class="citation" data-cites="functionalScala:2014">(Chiusano and Bjarnason 2014)</span>:</strong></span> davvero una grande scoperta. Questo libro rappresenta un insieme di <strong>buone pratiche</strong> e <strong>aspetti teorici</strong> che ogni programmatore Scala dovrebbe conoscere. Personalmente di grande utilità sono stati i capitoli che trattano la <strong>gestione degli errori</strong> e gli aspetti funzionali più avanzati (<code>monoids, monads</code> e <code>applicative functors</code>).</p></li>
</ul></li>
<li><p><span><strong>Conferenze:</strong></span></p>
<ul class="incremental">
<li><p><span><strong>Scala Days:</strong></span> Sono le conferenze ufficiali di Scala che ogni anno hanno luogo in un paese diverso. I talk proposti sono estremamente interessanti e permettono di apprendere un gran numero di <strong>tecniche avanzate</strong> e sopratutto costituiscono un ottimo esempio di <strong>buona programmazione</strong>. Conferenze consigliate:</p>
<ul class="incremental">
<li><p><span><em><a href="https://www.youtube.com/watch?v=30q6BkBv5MY">Functional Programming with Effects by Rob Norris</a></em></span></p></li>
<li><p><span><em><a href="https://www.youtube.com/watch?v=DGa58FfiMqc">Scala best practices I wish someone’d told me about - Nicolas Rinaudo</a></em></span></p></li>
<li><p><span><em><a href="https://www.youtube.com/watch?v=pHHKUKubs1Q&amp;t=2002s">Migrating to Scala 2.13 by Julien Richard Foy and Stefan Zeiger</a></em></span></p></li>
<li><p><span><em><a href="https://www.youtube.com/watch?v=CrpJJYPzdJE&amp;t=630s">Akka Streams to the Extreme - Heiko Seeberger</a></em></span></p></li>
<li><p><span><em><a href="https://www.youtube.com/watch?v=TqJg4AuxEIQ">Concurrent programming in 2019: Akka, Monix or ZIO? - Adam Warski</a></em></span></p></li>
<li><p><span><em><a href="https://www.youtube.com/watch?v=wfbF5jQiAhQ">Security with Scala Refined Types and Object Capabilities by Will Sargent</a></em></span></p></li>
<li><p><span><em><a href="https://www.youtube.com/watch?v=_Rnrx2lo9cw">A Tour of Scala 3 - Martin Odersky</a></em></span></p></li>
</ul></li>
<li><p><span><strong>Scalapeño:</strong></span> come dice il nome stesso, sono <strong>conferenze piccanti</strong> che hanno lo scopo di smuovere le acque all’interno della comunità di Scala. Conferenze consigliate:</p>
<ul class="incremental">
<li><p><span><em><a href="https://www.youtube.com/watch?v=v8IQ-X2HkGE">The Last Hope for Scala’s Infinity War - John A. De Goes</a></em></span></p></li>
<li><p><span><em><a href="https://www.youtube.com/watch?v=Arwb6DSrWXE&amp;t=102s">Scala vs. Kotlin, friend or foe? - Ohad Shai</a></em></span></p></li>
</ul></li>
<li><p><span><strong>Altre conferenze:</strong></span></p>
<ul class="incremental">
<li><p><span><em><a href="https://www.youtube.com/watch?v=71yhnTGw0hY&amp;feature=youtu.be">John De Goes - 12 Steps To Better Scala (Part I)</a></em></span></p></li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="ruben-ceroni" data-number="6.2">
<h2 data-number="6.2"><span class="header-section-number">6.2</span> Ruben Ceroni</h2>
<p>Lo studente Ruben Ceroni, conclusa la parte iniziale di analisi e progettazione comune si è concentrato sull’implementazione dei sistemi core del gioco e della loro integrazione con il resto del sistema.</p>
<section id="aisystem" data-number="6.2.1">
<h3 data-number="6.2.1"><span class="header-section-number">6.2.1</span> AISystem</h3>
<p>L’<code>AISystem</code> si occupa di generare gli spostamenti per le entità non controllate dal giocatore dotate di intelligenza artificiale e quindi di un AIComponent, nel quale è specificata la precisione dell’intelligenza artificiale e i possibili bersagli della stessa.</p>
<p>Il core della logica di movimento è stato implementato in <strong>Prolog</strong>, attraverso il predicato <code>move_avoiding(+Q,+(SX,SY),+(TX,TY),+O,-DX,-DY)</code> che, prendendo in input una tupla (X,Y) di partenza e una di destinazione, fornisce in output il vettore direzione da prendere per arrivare alla destinazione. La precisione è influenzabile tramite l’argomento Q, che esprime di quanto verrà falsata la posizione da raggiungere fornita in input. L’array di posizioni O è necessario ad evitare che più nemici con lo stesso bersaglio si scontrino eccessivamente tra di loro inseguendolo. La direzione risultante calcolata viene inserita nella stessa coda gestita dall’InputSystem che quindi gestisce lo spostamento delle entità nemiche allo stesso modo dei player.</p>
</section>
<section id="endgamesystem" data-number="6.2.2">
<h3 data-number="6.2.2"><span class="header-section-number">6.2.2</span> EndGameSystem</h3>
<p>L’EndgameSystem si occupa di monitorare lo stato della partita e di rimuovere le entità che escono dal bordo fornitogli in input o la cui vita abbia raggiunto lo 0 a causa delle collisioni subite. All’eliminazione di un’entità viene inviato tramite il mediator un <strong>LevelEndEvent</strong> contenente lo status della partita, l’entità eliminata e il punteggio ottenuto eliminandola. Nel caso si tratti di un’entità nemica esso viene semplicemente rimosso dal gioco. Mentre se si tratta di un’entità player o il player stesso rimane da solo in gioco, la partita viene considerata conclusa e viene stoppato l’engine, mentre lato view è mostrata la schermata di vittoria o di sconfitta.</p>
</section>
<section id="powerupsystem" data-number="6.2.3">
<h3 data-number="6.2.3"><span class="header-section-number">6.2.3</span> PowerUpSystem</h3>
<p>Sono stati implementati 3 differenti tipi di powerUp.</p>
<p>L’attivazione di un powerUp è controllata dal <strong>CollisionSystem</strong>, che alla collisione di una entità player con un powerUp ne inserirà il riferimento all’interno del <strong>PowerUpComponent</strong> del powerUp.</p>
<p>Il comportamento specifico del singolo powerUp è specificato invece all’in-terno del suo <strong>PowerUpEffect</strong>, tramite una funzione che specifica come modificare il valore del componente modificato.</p>
</section>
<section id="engine-e-gameloop" data-number="6.2.4">
<h3 data-number="6.2.4"><span class="header-section-number">6.2.4</span> Engine e GameLoop</h3>
<p>L’Engine rappresenta la parte core del gioco, e si occupa di istanziare i componenti principali e di registrare le entità del livello presso il Coordinator. Il <strong>GameLoop</strong> è stato implementato come un thread separato che durante la sua esecuzione chiamerà il metodo tick dell’<strong>UpdatableEngine</strong> fornitogli in input, che porta all’aggiornamento di tutti i sistemi e la produzione di un frame di gioco. Per mantenere costante la frequenza di aggiornamento viene calcolato il tempo trascorso per produrre il frame e nel caso sia inferiore alla durata necessaria a mantenere gli fps costanti viene fatto attendere il thread.</p>
</section>
</section>
<section id="gyordan-caminati" data-number="6.3">
<h2 data-number="6.3"><span class="header-section-number">6.3</span> Gyordan Caminati</h2>
<p>Lo studente Gyordan Caminati si è occupato prevalentemente nelle seguenti macro-aree:</p>
<ol class="incremental">
<li><p><strong>Manager</strong></p></li>
<li><p><strong>Multiplayer</strong></p></li>
<li><p><strong>View</strong></p></li>
<li><p><strong>Controller</strong></p></li>
</ol>
<section id="manager" data-number="6.3.1">
<h3 data-number="6.3.1"><span class="header-section-number">6.3.1</span> Manager</h3>
<p>Lo studio e l’implementazione di tutti i <strong>Manager</strong> sono stati svolti individualmente. In particolare, lo studente si è occupato delle seguenti parti:</p>
<ul class="incremental">
<li><p>File Manager</p></li>
<li><p>Package Object</p></li>
<li><p>Audio Agent</p></li>
<li><p>Data Manager</p></li>
<li><p>Yaml Manager</p></li>
</ul>
<section id="file-manager" data-number="6.3.1.1">
<h4 data-number="6.3.1.1"><span class="header-section-number">6.3.1.1</span> File Manager</h4>
<p>Il File Manager permette di effettuare le operazioni di gestione dei file, come, ad esempio, il caricamento da Jar, la cancellazione di una cartella o la creazione di un albero delle cartelle. Il File Manager è stato realizzato come un <em>Singleton</em> poiché si è ritenuto concettualmente corretto che ne esistesse solo uno, visibile da qualsiasi punto ci si trovi e che espone i metodi principali per la gestione dei file.</p>
</section>
<section id="package-object" data-number="6.3.1.2">
<h4 data-number="6.3.1.2"><span class="header-section-number">6.3.1.2</span> Package Object</h4>
<p>All’interno del package File, dove risiedono diversi manager che necessitano di eseguire operazioni su file, si è ritenuto necessario introdurre un Package Object che esponesse dei metodi per facilitarne la gestione. Alcune delle operazioni da agevolare riguardavano, ad esempio, l’utilizzo pervasivo di <code>Path</code>, <code>File</code> e <code>Stringhe</code> che identificano il percorso in forma testuale. Nel <strong>Package Object</strong> sono inoltre presenti anche tutte le costanti che servono a risalire al percorso dei file testuali.</p>
<p>L’introduzione del Package Object ha migliorato notevolmente il flusso di programmazione dato che il passaggio da <code>String</code> a <code>Path</code> è molto intuivo e naturale. Lo stesso discorso può essere applicato anche per <code>Path</code> e <code>File</code>. L’aggiunta di questi due metodi impliciti fornisce gratuitamente il passaggio da <code>String</code> a <code>File</code>.</p>
<p>Data la <strong>forte probabilità</strong> di incappare in una <code>Exception</code> durante una qualunque operazione I/O,si è deciso di sviluppare un ultimo metodo che incapsulasse una <code>Try</code> e trasformasse l’eventuale <code>Exception</code> in un <code>Boolean</code>, riportando successivamente su un <strong>Log</strong> l’accaduto.</p>
<div class="sourceCode" id="lst:listato2222" data-caption="Package Object" label="lst:listato2222"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="lst:listato2222-1"><a href="#lst:listato2222-1"></a><span class="kw">implicit</span> <span class="kw">def</span> <span class="fu">stringPathToPath</span>(path: String): Path = Paths.<span class="fu">get</span>(path)</span>
<span id="lst:listato2222-2"><a href="#lst:listato2222-2"></a></span>
<span id="lst:listato2222-3"><a href="#lst:listato2222-3"></a><span class="kw">implicit</span> <span class="kw">def</span> <span class="fu">pathToFile</span>(path: Path): File = path.<span class="fu">toFile</span></span>
<span id="lst:listato2222-4"><a href="#lst:listato2222-4"></a></span>
<span id="lst:listato2222-5"><a href="#lst:listato2222-5"></a><span class="kw">def</span> tryAndBoolResult[T](operation: =&gt; T)(Logger): Boolean =</span>
<span id="lst:listato2222-6"><a href="#lst:listato2222-6"></a>  <span class="fu">Try</span>(operation).<span class="fu">fold</span>(error =&gt; {logger.<span class="fu">warn</span>(error.<span class="fu">getMessage</span>); <span class="kw">false</span> }, _ =&gt; <span class="kw">true</span>)</span></code></pre></div>
<section id="frammento-di-codice-dallpackage-object-in-nel-package-file." data-number="6.3.1.2.1">
<h5 data-number="6.3.1.2.1"><span class="header-section-number">6.3.1.2.1</span> Frammento di codice dall’Package Object in nel package file.</h5>
</section>
</section>
<section id="audio-agent" data-number="6.3.1.3">
<h4 data-number="6.3.1.3"><span class="header-section-number">6.3.1.3</span> Audio Agent</h4>
<p>L’<code>Audio Agent</code> è il modulo preposto alla gestione dei suoni. Nonostante se ne utilizzi effettivamente uno solo si è scelto di non renderlo un <strong>Singleton</strong>, come è stato invece fatto con il <code>File Manager</code>. Alla base di questa scelta vi è la volontà di non precludere estensioni future.</p>
<p>Per la realizzazione dell’Agente, si è scelto di mantenere un approccio più conservativo.</p>
<p>L’Agent mantiene al suo interno un <code>Thread</code> che manipola e riproduce effetti e musica. La riproduzione di musica e effetti con un alta frequenza, richiede notevoli risorse, l’unione del Thread a una coda di messaggi(poi divenuta coda di eventi grazie all’apporto fornito da Giulianini) consente un’ ottima separazione dei flussi di controllo, e coesione con altri Thread.</p>
<p>Nonostante l’implementazione attuale volga lo sguardo verso un approccio generico, l’interfaccia lascia la strada aperta a successive implementazioni, come Agent specifici per suoni ad alta qualità, mantenendo sempre un approccio molto pulito e neutrale.</p>
<p>Il contributo di design apportato dal collega <strong>Giulianini</strong> ha consentito di trasformare il modello a messaggi, in un modello ad eventi. In questo modo si è riusciti a rendere il tutto più pulito e ad evitare un match case che avrebbe sporcato l’implementazione.</p>
</section>
<section id="yaml-manager" data-number="6.3.1.4">
<h4 data-number="6.3.1.4"><span class="header-section-number">6.3.1.4</span> Yaml Manager</h4>
<p>La serializzazione e la deserializzazione di tutti i dati <strong>Locali</strong> è gestita unicamente dallo <strong>Yaml Manager</strong>. Esso fornisce solo poche funzioni generiche, astraendo e delegando ad un livello superiore la concatenazione e l’utilizzo delle stesse.</p>
<p>La <strong>Serializzazione</strong> è effettuata principalmente utilizzando il formato <code>Yaml</code>. Inizialmente è stato valutato anche l’utilizzo di <code>Json</code>, ma quest’ultimo risultava più prolisso e meno leggibile. Per questo motivo si è preferito scegliere Yaml. Questa decisione è stata guidata anche dal fatto che il <strong>livello</strong> (la principale fonte di serializzazione) è composto prevalentemente da una lista di <code>Entity</code> e alcuni parametri. Le liste in <code>Yaml</code> sono particolarmente leggibili.</p>
<p>Per la serializzazione si è scelto di utilizzare un serializzatore basato su <code>Jackson</code>, perché esso è molto veloce. <code>Jackson</code>, inoltre, ha consentito una scrittura pulita dei dati da serializzare. Normalmente per la serializzazione di una classe, sarebbe necessario l’utilizzo pervasivo di annotazioni come, ad esempio: <code>@JsonProperty</code> o <code>@JsonFormat</code>; tuttavia la definizione di dati snelli e l’utilizzo di un <code>PolymorphicTypeValidator</code> hanno consentito di serializzare e deserializzare senza la necessità di ricorrere ad annotazioni.</p>
</section>
<section id="data-manager" data-number="6.3.1.5">
<h4 data-number="6.3.1.5"><span class="header-section-number">6.3.1.5</span> Data Manager</h4>
<p>La gestione di tutti i dati è demandata al <strong>Data Manager</strong> il quale fornisce metodi diretti per il salvataggio e il caricamento di tutti i file testuali del progetto come: livelli, punteggi e impostazioni. Il caricamento e il salvataggio dei livelli può avvenire sia nel <strong>File System</strong> sia nel <strong>Jar</strong>.</p>
</section>
</section>
<section id="view" data-number="6.3.2">
<h3 data-number="6.3.2"><span class="header-section-number">6.3.2</span> View</h3>
<p>Lo studente si è occupato in particolare dello sviluppo di tutte le schermate ad eccezione di <strong>Level</strong> e <strong>Game</strong>. Ogni schermata si appoggia sopra l’architettura base sviluppata dal collega <strong>Giulianini</strong>. Tutte le view utilizzano il pattern <code>Observer</code>.</p>
<p>Di seguito, le schermate che lo studente ha realizzato e gestito:</p>
<ul class="incremental">
<li><p>Stats</p></li>
<li><p>Settings</p></li>
<li><p>ModeSelection</p></li>
<li><p>Home</p></li>
<li><p>Lobby</p></li>
</ul>
<section id="stats" data-number="6.3.2.1">
<h4 data-number="6.3.2.1"><span class="header-section-number">6.3.2.1</span> Stats</h4>
<p>Una semplice schermata che fornisce all’utente una visuale su tutti i record degli utenti registrati al sistema. Chiede al <strong>Controller</strong> la tabella dei record e la mostra.</p>
</section>
<section id="settings" data-number="6.3.2.2">
<h4 data-number="6.3.2.2"><span class="header-section-number">6.3.2.2</span> Settings</h4>
<p>La schermata adibita alle impostazioni, che appoggia sul Controller per le operazioni di IO. Essa consente al giocatore di cambiare: Nome, Difficoltà e volume di suoni e musica. Quando un giocatore cambia nome, può inserire anche un nome già utilizzato in precedenza; in questo caso ulteriori nuovi record con quel nome sovrascriveranno il precedente.</p>
</section>
<section id="modeselection" data-number="6.3.2.3">
<h4 data-number="6.3.2.3"><span class="header-section-number">6.3.2.3</span> ModeSelection</h4>
<p>La schermata di ModeSelection separa la <strong>Home</strong> dal <strong>Game</strong>. Essa permette di scegliere se diventare un <strong>Client</strong> o un <strong>Server</strong>. Nel primo caso è necessario fornire un IP e una porta per potersi connettere al server; mentre nel secondo caso verranno scelta una porta libera e un interfaccia di rete disponibile su cui far connettere i client. Il controllo dell’input consente di evitare inserimenti erronei e le notifiche avvisano il giocatore nel caso in cui il suo nome sia già presente in partita oppure il server sia pieno.</p>
<p>Nel caso in cui si cerchi di contattare un server su un indirizzo sbagliato, verrà notificato un messaggio di timeout.</p>
</section>
<section id="home" data-number="6.3.2.4">
<h4 data-number="6.3.2.4"><span class="header-section-number">6.3.2.4</span> Home</h4>
<p>La schermata iniziale presenta sullo sfondo un tema a griglia e consente all’utente di navigare attraverso tutte le opzioni.</p>
</section>
<section id="lobby" data-number="6.3.2.5">
<h4 data-number="6.3.2.5"><span class="header-section-number">6.3.2.5</span> Lobby</h4>
<p>La schermata di lobby mostra un notevole numero di informazioni; l’IP del server e la sua porta, la lista di giocatori pronti e non pronti. Il server ha inoltre il potere di espellere giocatori a piacimento, un eventuale giocatore espulso riceverà una notifica di allontanamento.</p>
<p>Quando tutti i giocatori presenti nella lobby sono pronti, il server può far partire la partita. È possibile partire anche con un numero inferiore di giocatori, a patto che siano tutti pronti.</p>
<section id="ogni-bottone-presente-nelle-view-quando-premuto-accoda-un-evento-al-soundagent-che-lo-applica.-le-varie-view-sviluppate-dallo-studente-non-possono-comunicare-tra-loro-e-lunico-punto-di-contatto-rimane-sempre-il-controller-tramite-linterfaccia-dellobserver-observableui." data-number="6.3.2.5.1">
<h5 data-number="6.3.2.5.1"><span class="header-section-number">6.3.2.5.1</span> Ogni bottone presente nelle view quando premuto accoda un evento al <code>SoundAgent</code> che lo applica. Le varie view sviluppate dallo studente non possono comunicare tra loro, e l’unico punto di contatto rimane sempre il controller, tramite l’interfaccia dell’observer ObservableUI.</h5>
</section>
</section>
</section>
<section id="controller" data-number="6.3.3">
<h3 data-number="6.3.3"><span class="header-section-number">6.3.3</span> Controller</h3>
<p>Il Controller contiene la struttura dati della lobby, usata per il mantenimento di una lobby durante la fase preliminare di una partita. Contiene tutta la configurazione di akka e anche un attore. Non vi sono mai due attori aperti in contemporanea, mentre è possibile che non siano presenti attori(Single Player). Mantiene anche il <code>Mediator</code> che però non utilizza direttamente. Internamente utilizza anche il <strong>Data Manager</strong> che viene impiegato per il caricamento e la serializzazione di tutti i dati. Contiene anche l’<strong>Engine</strong> e il <strong>Sound Agent</strong>, i quali sono comandati direttamente dal controller stesso.</p>
<p>Il controller è suddiviso in quattro Interfacce:</p>
<ul class="incremental">
<li><p><code>ActorController</code></p></li>
<li><p><code>EngineController</code></p></li>
<li><p><code>ObservableUI</code></p></li>
<li><p><code>SoundController</code></p></li>
</ul>
<p>L’interfaccia <code>SoundController</code> viene estesa da <code>EngineController</code>, ActorController e ObservableUI; così facendo il controller fornisce un punto di ingresso al metodo <code>redirectSoundEvent</code> che consente di accodare un evento che successivamente verrà eseguito.</p>
<p>L’interfaccia <code>EngineController</code> estende il <code>SoundController</code>; di conseguenza, oltre a fornire la possibilità di accodare <code>MediaEvent</code>, fornisce anche un getter per il <code>Mediator</code>, così l’<code>Engine</code> che lo contiene può sottoscriversi, ma può anche passare l’EngineController ad alcuni dei suoi come: <code>CollisionSystem</code> e <code>PowerUpSystem</code>, i quali ne faranno uso per pubblicare eventi sul <code>Mediator</code> e inviare eventi all’<code>AudioAgent</code>.</p>
<p>L’interfaccia <code>ActorController</code> mette a disposizione degli attori i metodi necessari per instaurare una partita, gestirla e terminarla. Inoltre fornisce anche la possibilità agli attori di inviare alla lobby tramite un metodo generico una <strong>strategia</strong> per interrogarne e manipolarne direttamente il contenuto.</p>
<div class="sourceCode" id="lst:listato212" data-caption="Actor Controller" label="lst:listato212"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="lst:listato212-1"><a href="#lst:listato212-1"></a><span class="kw">override</span> <span class="kw">def</span> sendToLobbyStrategy[T](strategy: MultiPlayerSetup =&gt; T): T = strategy.<span class="fu">apply</span>(matchSetupMp.<span class="fu">get</span>)</span>
<span id="lst:listato212-2"><a href="#lst:listato212-2"></a></span>
<span id="lst:listato212-3"><a href="#lst:listato212-3"></a><span class="kw">override</span> <span class="kw">def</span> <span class="fu">sendToViewStrategy</span>(strategy: ObserverUI =&gt; Unit): Unit =</span>
<span id="lst:listato212-4"><a href="#lst:listato212-4"></a>  observers.<span class="fu">foreach</span>(obs =&gt; Platform.<span class="fu">runLater</span>(() =&gt; <span class="fu">strategy</span>(obs)))</span></code></pre></div>
<p>Allo stesso modo ma senza ritorno alcuno, fornisce la possibilità di inviare una strategia verso la View, nella quale incapsula un evento che viene gestito poi dalla view stessa tramite <code>notify</code>.</p>
</section>
<section id="multiplayer-2" data-number="6.3.4">
<h3 data-number="6.3.4"><span class="header-section-number">6.3.4</span> Multiplayer</h3>
<p>Lo studente si è occupato prevalentemente dell’integrazione di <code>ClientActor</code> e <code>Server Actor</code>.</p>
<p>Entrambi gli attori comunicano con l’<code>Actor controller</code> chiamando metodi su di esso; mentre tra di loro comunicano tramite scambio di messaggi. Sono presenti diversi messaggi e sono gestiti in <code>Behaviour</code> ben precisi.</p>
<p>Dato che entrambi gli attori dovevano riportare un log nel caso in cui avessero ricevuto un messaggio fuori dal <code>Behaviour</code> corretto e che entrambi dovevano gestire il messaggio <code>PlayMediaMessage</code> (Inviato dal server per permettere al client di riprodurre suoni come collisioni e vittoria) è stato ritenuto necessario introdurre un <code>ActorWithLogging</code>. Questa classe astratta estende <code>Actor</code> e <code>ActorLogging</code> e fornisce un metodo <code>changeBehaviourWhitLogging</code> che viene utilizzato alternativamente alla <code>context.become</code>. Questa funzione concatena la <code>PartialFunction</code> <code>Receive</code> fornita in input(Behaviour) e fornisce in uscita una <code>PartialFunction</code> che è di fatto esaustiva dato che effettua un match su tutto e effettua una operazione di log.</p>
<p>Questo consente di extendere il <code>Behaviour</code> passato e ottenere per ogni caso non gestito la certezza di un log, evitando così anche errori.</p>
<p>Inoltre è possibile introdurre un ulteriore <code>Behaviour</code> di default, che verrà chiamato dopo il classico <code>Behaviour</code>, ma prima di quello esaustivo.</p>
<p>Nel caso del server il <code>Behaviour</code> di default introdotto ridireziona tutti i <code>PlayMediaMessage</code> verso i suoi client. Nel caso del Client il <code>PlayMedia-Message</code> viene inviato al <code>SoundAgentSoundAgent</code> il quale lo consumerà lanciando il media.</p>
<div class="sourceCode" id="lst:listato22" data-caption="Actor Controller" label="lst:listato22"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="lst:listato22-1"><a href="#lst:listato22-1"></a><span class="kw">override</span> <span class="kw">def</span> sendToLobbyStrategy[T](strategy: MultiPlayerSetup =&gt; T): T = strategy.<span class="fu">apply</span>(matchSetupMp.<span class="fu">get</span>)</span>
<span id="lst:listato22-2"><a href="#lst:listato22-2"></a></span>
<span id="lst:listato22-3"><a href="#lst:listato22-3"></a><span class="kw">override</span> <span class="kw">def</span> <span class="fu">sendToViewStrategy</span>(strategy: ObserverUI =&gt; Unit): Unit =</span>
<span id="lst:listato22-4"><a href="#lst:listato22-4"></a>  observers.<span class="fu">foreach</span>(obs =&gt; Platform.<span class="fu">runLater</span>(() =&gt; <span class="fu">strategy</span>(obs)))</span></code></pre></div>
<section id="contributi-esterni" data-number="6.3.4.0.1">
<h5 data-number="6.3.4.0.1"><span class="header-section-number">6.3.4.0.1</span> Contributi esterni</h5>
<p>Lo studente ha contribuito all’implementazione delle strutture dati principali del model come : <code>MatchSetup</code>(lobby), <code>Difficulties</code> e <code>Settings</code>. Inoltre ha prodotto la prima implementazione di difficoltà, poi rifinita da <strong>Giulianini</strong>.</p>
</section>
</section>
</section>
</section>
<section id="retrospettiva" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Retrospettiva</h1>
<section id="processo-di-sviluppo-1" data-number="7.1">
<h2 data-number="7.1"><span class="header-section-number">7.1</span> Processo di Sviluppo</h2>
<p>Durante le fasi iniziali di analisi dei requisiti e durante la Sprint 0 ci si è appoggiati al tool <strong>Trello</strong> per tenere traccia dei task da eseguire e degli artefatti prodotti.</p>
<p>In seguito, entrati nel vivo del progetto, si è deciso di utilizzare ai <strong>Project</strong> di <strong>GitHub</strong>, che mettono a disposizione un kanban virtuale come trello, ma completamente integrato con le issue di github e automatizzabile.</p>
<p>Una volta completata la fase iniziale e definiti gli item del backlog, essi sono stati inseriti in un <strong>GitHub Project</strong> relativo all’organizzazione GitHub creata per il progetto, consultabile all’indirizzo <a href="https://github.com/orgs/Unibo-PPS-1920/projects/2">https://github.com/orgs/Unibo-PPS-1920/projects/2</a>.</p>
<p>Sotto la stessa organizzazione sono stati creati sia il repository che contiene la relazione che quello contenente l’effettivo progetto. Per ogni sprint è stato creato un nuovo github project in cui ddddddddddddddsono stati importati gli <strong>item</strong> del backlog relativi alla sprint dal project globale.</p>
<p>Questo approccio ha consentito di avere una visione pulita dello stato del progetto a livello alto e una visione più granulare a livello di sprint.</p>
</section>
<section id="backlog" data-number="7.2">
<h2 data-number="7.2"><span class="header-section-number">7.2</span> Backlog</h2>
<p>Ogni item del backlog è stato formulato sotto forma di <strong>User story</strong>, dopo avere selezionato gli item da completare durante lo sprint planning, essi vengono tradotti in uno o più sotto-task implementativi.</p>
</section>
<section id="iterazioni" data-number="7.3">
<h2 data-number="7.3"><span class="header-section-number">7.3</span> Iterazioni</h2>
<section id="sprint-0" data-number="7.3.1">
<h3 data-number="7.3.1"><span class="header-section-number">7.3.1</span> Sprint 0</h3>
<p>A questo sprint è stato assegnato il numero 0 perchè non propriamente parte del processo di sviluppo iterativo, ma fondamentale per la produzione di solide basi per gli sprint successivi.</p>
<section id="svolgimento" data-number="7.3.1.1">
<h4 data-number="7.3.1.1"><span class="header-section-number">7.3.1.1</span> Svolgimento</h4>
<p>Sono stati identificati i pattern architetturali applicabili e sviluppati in dettaglio i modelli delle parti principali del sistema</p>
</section>
</section>
<section id="sprint-1" data-number="7.3.2">
<h3 data-number="7.3.2"><span class="header-section-number">7.3.2</span> Sprint 1</h3>
<section id="svolgimento-1" data-number="7.3.2.1">
<h4 data-number="7.3.2.1"><span class="header-section-number">7.3.2.1</span> Svolgimento</h4>
<p>In questo sprint ci si è concentrati sul setup del progetto, in particolare di <strong>Travis CI</strong> e di <strong>Gradle</strong>, l’implementazione dello scheletro modellato nello sprint precendente. In particolare sono stati implementati i componenti principali di ECS e il game engine.</p>
</section>
</section>
<section id="sprint-2" data-number="7.3.3">
<h3 data-number="7.3.3"><span class="header-section-number">7.3.3</span> Sprint 2</h3>
<p>L’obiettivo di questa sprint è stato quello di mostrare una schermata all’uten-te con cui esso possa interagire.</p>
<section id="svolgimento-2" data-number="7.3.3.1">
<h4 data-number="7.3.3.1"><span class="header-section-number">7.3.3.1</span> Svolgimento</h4>
<p>Lato view è stata sviluppata l’architettura principale MVC, il menu principale e il canvas. Sono stati aggiunti i 3 system principali: InputSystem, DrawSystem e MovementSystem.</p>
</section>
<section id="considerazioni" data-number="7.3.3.2">
<h4 data-number="7.3.3.2"><span class="header-section-number">7.3.3.2</span> Considerazioni</h4>
<p>Questo sprint è stato terminato con un leggero ritardo dovuto alla mole di lavoro necessaria a raggiungere l’obiettivo prefissatosi.</p>
</section>
</section>
<section id="sprint-3" data-number="7.3.4">
<h3 data-number="7.3.4"><span class="header-section-number">7.3.4</span> Sprint 3</h3>
<p>L’obiettivo di questa sprint è stato quello di introdurre le feature mancanti dell’esperienza base del gioco.</p>
<section id="svolgimento-3" data-number="7.3.4.1">
<h4 data-number="7.3.4.1"><span class="header-section-number">7.3.4.1</span> Svolgimento</h4>
<p>Sono state introdotte le componenti relative alla gestione degli scontri e l’intelligenza artificiale dei nemici, la gestione dei powerUp e la riproduzione dei suoni.</p>
</section>
<section id="considerazioni-1" data-number="7.3.4.2">
<h4 data-number="7.3.4.2"><span class="header-section-number">7.3.4.2</span> Considerazioni</h4>
<p>Questo sprint si è rivelato più corposo del previsto, principalmente dovuto a un’astrazione non perfetta delle componenti di fisica, che hanno portato a un parziale redesign delle stesse all’introduzione del collision system.</p>
</section>
</section>
<section id="sprint-4" data-number="7.3.5">
<h3 data-number="7.3.5"><span class="header-section-number">7.3.5</span> Sprint 4</h3>
<p>In questo sprint ci si è concentrati sull’aggiunta degli aspetti più avanzati come il multiplayer e sulla pulizia finale del codice</p>
<section id="svolgimento-4" data-number="7.3.5.1">
<h4 data-number="7.3.5.1"><span class="header-section-number">7.3.5.1</span> Svolgimento</h4>
<p>È stato completato e rifinito il gioco. Sono state portate a termine la parte di integrazione con il multiplayer, la definizione dei livelli, l’aggiunta della durata vitale e del danno, il completamento e la revisione della documentazione, l’individuazione e la correzione di bug, il refactoring e la pulizia del codice.</p>
<div id="refs" class="references hanging-indent" role="doc-bibliography">
<div id="ref-akkaSite">
<p>“Akka’s Site.” n.d. <a href="https://akka.io/docs/">https://akka.io/docs/</a>.</p>
</div>
<div id="ref-scalaCook:2013">
<p>Alexander, A. 2013. <em>Scala Cookbook</em>. O’Reilly.</p>
</div>
<div id="ref-functionalScala:2014">
<p>Chiusano, P., and R. Bjarnason. 2014. <em>Functional Programming in Scala</em>. Mannings.</p>
</div>
<div id="ref-scalaBook:2014">
<p>M. Odersky, B. Venners, L. Spoon. 2016. <em>Programming in Scala</em>. Artima.</p>
</div>
<div id="ref-scalaLearning:2014">
<p>Swartz, J. 2014. <em>Learning Scala–Practical Functional Programming for the Jvm</em>. O’Reilly.</p>
</div>
<div id="ref-scalaCats:2020">
<p>Welsh, N., and D. Gurnell. 2020. <em>Scala with Cats</em>. Underscore Consulting LLP, Brighton, UK.</p>
</div>
</div>
</section>
</section>
</section>
</section>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Questo avviene solamente quando la frequenza di invio dei comandi supera la frequenza di aggiornamento di gioco.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>                    
                </div>
            </div>

            <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>
        </div>
    </body>
</html>
